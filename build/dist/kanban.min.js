/*
*   @type javascript
*   @name config.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name events.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name states.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name util.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name coutner.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name http.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name node.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name router.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name modal.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name console.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name gui.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*    @type javascript test
*    @name main.test.js
*    @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name main.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name kanban.js
*   @copy Copyright 2015 Harry Phillips
*/

function kbsExpandObjectNode(e){"450px"!==e.parentNode.style.height?(e.parentNode.style.height="450px",e.className+=" kbs-rotate"):(e.parentNode.style.height="150px",e.className=e.className.replace("kbs-rotate",""))}if(define("config",{appName:"kbs",version:.8,enabled:!0,mode:"dev",offline:!1,test:!1,logs:{enabled:!0,gui:!0,filter:!1},gui:{enabled:!0,autorefresh:!0,console:{state:"kbs-open",autoscroll:!0,icons:{save:"file-text",clear:"trash",toggle:"terminal",close:"times",destroy:"unlink",example:"plus-circle",expand:"caret-square-o-right"}}},events:{silent:!1},routes:{console:{save:"kanban/endpoint/console/save.php"}},tooltips:{save:"Save the output buffer to text file",clear:"Clear all logs",toggle:"GUI Console State",close:"Close the console",destroy:"Destroy this console instance"}}),define("src/components/events",["config"],function(e){function t(){this.topics={}}return t.prototype.subscribe=function(e,t){this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t)},t.prototype.publish=function(t,n){if(this.topics[t]){var o;for(o=0;o<this.topics[t].length;o+=1)this.topics[t][o](n);"object"!=typeof n&&(n={data:n})}else if(!e.events.silent)throw new Error("Event '"+t+"' does not exist!")},new t}),define("src/components/status",{app:!1,gui:!1,console:!1}),define("src/util",["config","./components/events","./components/status"],function(e,t,n){var o={};return o.zerofy=function(e,t){for(;e.toString().length<(t||2);)e="0"+e;return e},o.spacify=function(e,t){for("string"!=typeof e&&(e=e.toString());e.length<t;)e=" "+e;return e},o.ftime=function(){var e=new Date,t=o.zerofy(e.getHours()),n=o.zerofy(e.getMinutes()),s=o.zerofy(e.getSeconds()),i=o.zerofy(e.getMilliseconds(),3);return t+":"+n+":"+s+"."+i},o.fdate=function(){var e=new Date,t=o.zerofy(e.getFullYear(),4),n=o.zerofy(e.getMonth(),2),s=o.zerofy(e.getDate(),2);return t+"-"+n+"-"+s},o.escapeRegEx=function(e){var t;return t=String(e).replace(/([\-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1"),t=t.replace(/\x08/g,"\\x08")},o.isArray=function(){},o.contains=function(e,t,n){var s,i=0,r=[];if(n=n||!1,!n)return-1!==e.indexOf(t);if(t=o.escapeRegEx(t),s=new RegExp("(\\W|^)"+t+"(\\W|$)"),o.isArray(e)){for(;i<e.length;)s.test(e[i])&&r.push(i),i+=1;return 0===r.length?!1:r.length>1?r:r[0]}return s.test(e)?!0:!1},o.log=function(s,i,r){if(e.logs.enabled){var c,l=0,a=[],d=e.logs.filter,u=[],p="",h=!1,f="",m="";for(c in arguments)arguments.hasOwnProperty(c)&&a.push(arguments[c]);if(a.length>2?"object"==typeof i&&(h=i,i=r):a.length>1?"object"==typeof s?(h=s,s="log"):"object"==typeof i&&(h=i,i=""):(i=s,s="log","object"==typeof i&&(h=i,i="")),!d||!o.contains(d,s,!0))for(p+="["+e.appName+"] ",p+=o.ftime(),p+=o.spacify("["+s+"]",8)+":> ",p+=i,u.push(p),e.logs.gui&&n.console&&(h&&(m="Object "+JSON.stringify(h,null,4)),f=p.replace(/\s/g," "),t.publish("gui/log",{msg:f,type:s,obj:m})),window.console[s]||(s="log"),h&&u.push(h);l<u.length;)window.console[s](u[l]),l+=1}},o.log("+ util.js loaded"),o}),define("src/components/counter",[],function(){function e(e,t){var n=0;this.target=e,this.exec=t,Object.defineProperty(this,"count",{get:function(){return n},set:function(t){n=t,n>=e&&this.exec()}})}return e}),define("src/components/http",["src/util","./counter"],function(e){function t(e){this.url=e.url,this.method=e.method||"GET",this.async=e.async||!0,this.data=JSON.stringify(e.data)||"nodata",this.callbacks={},this.callbacks.success=e.success||function(){},this.callbacks.fail=e.fail||function(){},n=this,e.send&&this.send(this.data)}var n;return t.prototype.encodeData=function(t){var n,o="";for(n in t)t.hasOwnProperty(n)&&(e.log(n),o+=n+"="+t[n]+"& ");return o},t.prototype.send=function(){var t=new XMLHttpRequest;t.open(this.method,this.url,this.async),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4===this.readyState&&(200===this.status&&this.status<400?(e.log("debug","HTTP 200: "+n.url),n.callbacks.success(this.responseText)):(e.log("debug","HTTP "+this.status+": "+n.url),n.callbacks.fail(this.responseText)))},t.send(n.encodeData(n.data)),t=null},t}),define("src/ui/node",["config"],function(){function e(e,t,n){this.type=e,this.classes=t,this.selector=n,this.element=document.createElement(e),this.element.className=t||"",n&&(this.element.id=n)}return e.prototype.addChild=function(t){return t.constructor===e||t instanceof e?void this.element.appendChild(t.element):void this.element.appendChild(t)},e.prototype.createChild=function(t,n,o){var s=new e(t,n,o);return this.addChild(s.element),s},e.prototype.destroy=function(){this.element.parentNode.removeChild(this.element)},e.prototype.clone=function(){var t=new e(this.type,this.classes,this.selector);return t.element=null,t.element=this.element.cloneNode(),t},e}),define("src/components/router",["config"],function(e){return{getRoute:function(t,n){return window.KBS_BASE_URL+e.routes[t][n]}}}),define("src/ui/modal",["config","src/util","src/components/events","src/components/http","src/components/status","./node"],function(e,t,n,o,s,i){function r(e,t,n){c=this,"string"!=typeof e&&(n=t,t=e,e=null),l=t,this.type=e,this.node=new i("div","kbs-modal"),this.node.element.style.display="none",e&&(this.node.element.className+=" kbs-"+e),this.onConfirm=n.confirm||function(){},this.onCancel=n.cancel||function(){},this.title=n.title,this.message=n.message,n.init&&this.init()}var c,l;return r.prototype.init=function(){var e,t,n=this.node.createChild("h2","kbs-modal-title"),o=this.node.createChild("p","kbs-modal-msg"),s=this.node.createChild("i","fa fa-times kbs-modal-close");n.element.textContent=this.title,o.element.textContent=this.message,s.element.onclick=function(){c.close()},this.node.addChild(n),this.node.addChild(s),this.node.addChild(o),"prompt"===this.type&&(e=this.node.createChild("span","kbs-confirm"),e.element.textContent="confirm",e.element.onclick=this.onConfirm,t=this.node.createChild("span","kbs-cancel"),t.element.textContent="cancel",t.element.onclick=this.onCancel,this.node.addChild(e),this.node.addChild(t)),l.addChild(this.node.element),this.open()},r.prototype.open=function(){l.tree.main.overlay.element.style.display="block",this.node.element.style.display="block"},r.prototype.close=function(){l.tree.main.overlay.element.style.display="none",this.node.element.style.display="none"},r}),define("src/ui/console",["config","src/util","src/components/events","src/components/http","src/components/status","src/components/router","src/ui/node","src/ui/modal"],function(e,t,n,o,s,i,r,c){function l(t){if(e.logs.gui){if(a=this,"undefined"==typeof t)throw new Error("No GUI instance passed to Console");d=t,this.buildNodeTree(),n.publish("kbs/status",{component:"console",status:!0})}}var a,d;return l.prototype.write=function(t){var n,o=a.wrapper.cons.out.element,s=new r("div","kbs-log-node kbs-"+t.type),i=document.createTextNode(t.msg),c=new r("pre","kbs-object"),l=new r("i","fa fa-"+e.gui.console.icons.expand+" kbs-object-expand");s.addChild(i),t.obj&&(n=document.createTextNode(t.obj),l.element.setAttribute("onclick","kbsExpandObjectNode(this)"),c.addChild(l.element),c.addChild(n),s.addChild(c.element)),o.appendChild(s.element),a.refresh()},l.prototype.createTool=function(t,n){if("undefined"==typeof t)throw new Error("No toolbar passed to GUI.Console.createTool()");var o;return o=this.getIcon(n),t[n]=t.createChild("i","fa fa-"+o+" kbs-tool kbs-"+n),t[n].element.title=e.tooltips[n]||"",t[n]},l.prototype.getIcon=function(t){return e.gui.console.icons[t]||"plus"},l.prototype.open=function(){var e=this.wrapper.element,t=e.className;e.className=t.replace(" kbs-close"," kbs-open")},l.prototype.close=function(){var e=this.wrapper.element,t=e.className;e.className=t.replace(" kbs-open"," kbs-close")},l.prototype.shrink=function(){},l.prototype.full=function(){},l.prototype.refresh=function(){var e=a.wrapper.cons.element;e.scrollTop=e.scrollHeight},l.prototype.clear=function(){var e,n=this.wrapper.cons.element,o=this.wrapper.cons.out.element,s=(new Date).getTime();for(n.removeChild(o);o.firstChild;)o.removeChild(o.firstChild);n.appendChild(o),e=(new Date).getTime()-s,t.log("okay","cleared all logs in "+e+" ms")},l.prototype.save=function(){{var e=t.ftime(),n=t.fdate(),s="log_"+n+"_"+e;new o({url:i.getRoute("console","save"),method:"POST",send:!0,data:{date:n,time:e,file:s},success:function(e){t.log("okay",e,"Save Response:")}})}},l.prototype.destroy=function(){var e="Destroy the Console instance?",t="Confirm destruction of the GUI Console (irreversible).",n=new c("prompt",d,{init:!0,title:e,message:t,confirm:function(){var e=a.wrapper.element.parentNode,t=a.wrapper.element;e.removeChild(t),n.close()},cancel:function(){n.close()}})},l.prototype.buildNodeTree=function(){var t,n,o,s,i,r,c;return n="kbs-cons-box "+e.gui.console.state,this.wrapper=t=d.createChild("div",n),o=t.constools=t.createChild("div","kbs-cons-toolbar"),s=o.constitle=o.createChild("div","kbs-cons-title"),i=document.createTextNode("Kanban v"+e.version),s.element.appendChild(i),this.createTool(o,"toggle").element.onclick=function(){var e=t.element.className,n=-1!==e.indexOf("kbs-close"),o=-1!==e.indexOf("kbs-full");n||o||(t.element.className+=" kbs-full"),o&&(t.element.className=t.element.className.replace(" kbs-full","")),n&&a.open()},this.createTool(o,"save").element.onclick=function(){a.save()},this.createTool(o,"destroy").element.onclick=function(){a.destroy()},this.createTool(o,"clear").element.onclick=function(){a.clear()},this.createTool(o,"close").element.onclick=function(){a.close()},t.cons=r=t.createChild("div","kbs-cons"),c=r.out=r.createChild("div","kbs-cons-out"),t},l}),define("src/ui/gui",["require","config","src/util","src/components/events","./node","src/components/counter","./console","./modal"],function(e){function t(){n=this,this.tree=this.buildNodeTree(),this.console=new l(this),this.modal=new a(this,{init:!1,title:"Test Modal - Title",message:"Test paragraph / modal content."}),i.publish("kbs/status",{component:"gui",status:!0})}var n,o=e("config"),s=e("src/util"),i=e("src/components/events"),r=e("./node"),c=e("src/components/counter"),l=e("./console"),a=e("./modal");return s.log("+ gui.js loaded"),t.prototype.init=function(){var e=new c(3,function(){i.publish("kbs/gui/loaded")}),t=document.createElement("link"),r=document.createElement("link"),l=document.createElement("link"),a=window.KBS_BASE_URL+window.KBS_SRC_DIR+"css/main.css",d=window.KBS_BASE_URL+window.KBS_SRC_DIR+"css/theme.css",u="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css",p=function(){document.body.appendChild(n.tree.main.element),s.log("debug","+ attached gui tree"),s.log("debug","+ publishing 'kbs/loaded'"),i.publish("kbs/loaded")};i.subscribe("kbs/gui/loaded",p),t.rel="stylesheet",r.rel="stylesheet",l.rel="stylesheet",t.href=a,r.href=d,l.href=u,t.onload=function(){s.log("debug","+ main.css loaded"),e.count+=1},t.onerror=function(){throw e.count+=1,new Error("main.css failed to load!")},r.onload=function(){s.log("debug","+ theme.css loaded"),e.count+=1},r.onerror=function(){throw e.count+=1,new Error("theme.css failed to load!")},l.onload=function(){s.log("debug","+ font-awesome.css loaded"),e.count+=1},l.onerror=function(){throw e.count+=1,new Error("font-awesome.css failed to load!")},o.offline||document.head.appendChild(l),document.head.appendChild(t),document.head.appendChild(r),o.gui.enabled&&(o.gui.autorefresh&&i.subscribe("gui/update",this.refresh),o.logs.gui&&i.subscribe("gui/log",this.console.write))},t.prototype.buildNodeTree=function(){var e,t={};return t.main=e=new r("div","kbs-gui"),e.overlay=t.main.createChild("div","kbs-overlay"),t},t.prototype.refresh=function(){this.console.refresh()},t.prototype.addChild=function(e){this.tree.main.element.appendChild(e)},t.prototype.createChild=function(e,t,n){var o=new r(e,t,n);return this.tree.main.element.appendChild(o.element),o},t.prototype.benchmark=function(){var e,t=n.console.wrapper.cons.element,o=n.console.wrapper.cons.out.element,i=(new Date).getTime(),r=0;for(t.removeChild(o);1e4>r;)s.log("debug","log #"+r),r+=1;t.appendChild(o),e=(new Date).getTime()-i,s.log("debug","opt: "+e+"ms")},t.prototype.getCurrentInstance=function(){return n},t}),define("test/main.test",["require","src/util"],function(e,t){return{exec:function(n){t.log("test",'executing test: "'+n+'"'),e(["./"+n+".test"])}}}),define("src/main",["config","./components/events","./util","./components/status","./components/http","./ui/gui","test/main.test"],function(e,t,n,o,s,i,r){var c,l,a;e.enabled&&(t.subscribe("kbs/status",function(e){o[e.component]=e.status}),e.gui.enabled&&(a=new i,a.init()),l=function(){window.KBS_END_TIME=(new Date).getTime()-window.KBS_START_TIME+"ms",n.log("okay",c,"Kanban initialised in "+window.KBS_END_TIME),"dev"===e.mode&&(window[e.appName]=c),t.publish("kbs/status",{component:"app",status:!0}),e.test&&r.exec(["util"])},c={version:e.version,status:o,config:e,events:t,http:s,util:n,gui:a},t.subscribe("kbs/loaded",l))}),!window.KBS_GLOBAL_SET)var KBS_GLOBAL_SET=!0,KBS_START_TIME=(new Date).getTime(),KBS_END_TIME,KBS_BASE_URL="http://localhost/proj/",KBS_SRC_DIR="kanban/";!function(e){var t=e.require;t.config({paths:{src:"src",test:"test"}}),t(["src/main"])}(window),define("kanban",function(){});