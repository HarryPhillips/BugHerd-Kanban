/*
*   @type javascript
*   @name config.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name events.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name status.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name buffer.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name cache.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name cookies.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name util.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name exception.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name repository.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name counter.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name http.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name viewloader.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name node.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name modal.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name configurator.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name bugherd.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name router.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name console.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name gui.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name interactor.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*    @type javascript test
*    @name main.test.js
*    @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name init.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name kanban.js
*   @copy Copyright 2015 Harry Phillips
*/

!function(){define("config",[],function(){function e(e){n=this,this.defaultObj=t(e),this.defaultObj.reset=this.reset,e.reset=this.reset,this.obj=e,o=this.obj}function t(e){var n,o,i,s;if(e instanceof Date)return n=new Date,n.setTime(e.getTime()),n;if(e instanceof Array){for(n=[],i=e.length,s=0;i>s;s+=1)n[s]=t(e[s]);return n}if(e instanceof Object){n={};for(o in e)e.hasOwnProperty(o)&&(n[o]=t(e[o]));return n}return"string"==typeof e||"number"==typeof e||"boolean"==typeof e?n=e:void 0}var n,o;return e.prototype.reset=function(){var e;for(e in n.obj)n.obj.hasOwnProperty(e)&&(n.defaultObj[e]||delete n.obj[e],n.obj[e]=n.defaultObj[e])},o=o||new e({appName:"kbs",appFullname:"Kanban",version:"1.4.0",enabled:!0,mode:"dev",httpToken:"Fw43Iueh87aw7",theme:"default",test:!1,logs:{enabled:!0,gui:!0,contexts:!0,contextFlag:"context:",obj2buffer:!1,filter:!1},gui:{enabled:!0,autorefresh:!0,wallpaper:"",severityStyles:!0,parallax:{enabled:!1,factor:100},console:{state:"kbs-closed",autoscroll:!0,allowDestruction:!1,destroyed:!1,displayed:!0,icons:{menu:"bars",toggle:"terminal",save:"file-text",clear:"trash",close:"times",destroy:"unlink",example:"plus-circle",benchmark:"tachometer",settings:"cogs",expand:"caret-square-o-right",toggleObjs:"list-alt"},benchmark:{amount:1e4}},modals:{behaviour:{stack:!0,shift:!0}}},interactor:{enabled:!0,observe:!1,expandOnclick:!0,filters:{metadata:{},clientdata:{}}},events:{silent:!1},cookies:{enabled:!0,prefix:"__kbs_"},routes:{console:{save:"endpoint/SaveBuffer.php"}},tooltips:{save:"Save log buffer",clear:"Clear console",menu:"Kanban Menu",toggle:"Toggle the console",close:"Close",destroy:"Destroy console",benchmark:"Benchmark",settings:"Settings",toggleObjs:"Toggle object logs"}}).obj}),define("main/components/events",["config"],function(e){function t(){this.topics={}}return t.prototype.subscribe=function(e,t){var n,o,i=function(e,t){this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t)}.bind(this);if(e instanceof Array)for(n=e.length,o=0;n>o;o+=1)i(e[o],t);else i(e,t)},t.prototype.unsubscribe=function(e,t){var n,o,i,s=!1,r=0,a=0;for("string"!=typeof t&&(s=!0),!e instanceof Array&&(e=[e]),o=e.length;o>r;r+=1)for(n=this.topics[e[r]],i=n.length;i>a;a+=1)if(s){if(t===n[a]||t.toSource()===n[a].toSource())return void n.splice(n.indexOf(a),1)}else if(n[a].name===t)return void n[a].splice(n.indexOf(a),1)},t.prototype.publish=function(t,n){if(this.topics[t]){var o;for(o=0;o<this.topics[t].length;o+=1)this.topics[t][o](n,t)}else if(!e.events.silent)throw new Error("Event '"+t+"' does not exist!")},new t}),define("main/components/status",{app:!1,interactor:{taskDetailsExpanded:!1},gui:!1,console:!1,modal:!1}),define("main/components/buffer",[],function(){function e(e){t.push(e||""),this.index=t.length-1}var t=[];return e.prototype.writeToBuffer=function(e){var n=this.index;return"string"==typeof t[n]?void(t[n]+=e):t[n]instanceof Array?void t[n].push(e):void 0},e.prototype.removeFromBuffer=function(e){var n,o=this.index;return"string"==typeof t[o]?void(t[o]=t[o].replace(e,"")):t[o]instanceof Array?(n=t[o].indexOf(e),void t[o].splice(n,1)):void 0},e.prototype.getBuffer=function(){return t[this.index]},e.prototype.getGlobalBuffer=function(){return t},e.prototype.clearBuffer=function(){var e=this.index;t[e]=null,t[e]=""},e}),define("main/components/cache",["main/components/buffer"],function(e){var t={app:new e,console:new e,logCount:0};return t}),define("main/components/cookies",["config"],function(e){function t(){}return t.prototype.get=function(t){var n,o,i=e.cookies.prefix+t+"=",s=document.cookie.split(";");for(o=0;o<s.length;o+=1){for(n=s[o];" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return""},t.prototype.set=function(t,n,o){var i,s;o?(s=new Date,s.setTime(s.getTime()+24*o*60*60*1e3),i="; expires="+s.toGMTString()):i="",document.cookie=e.cookies.prefix+t+"="+n+i+"; path=/"},t.prototype.del=function(e){this.set(e,"",-1)},t.prototype.exists=function(e){var t=this.get(e);return""!==t&&null!==t&&void 0!==t},t}),define("main/components/util",["config","main/components/events","main/components/status","main/components/cache","main/components/cookies","main/components/buffer"],function(e,t,n,o,i){function s(){}var r=new s;return s.prototype.refresh=function(e){"undefined"!=typeof e?setTimeout(function(){location.reload()},e):location.reload()},s.prototype.zerofy=function(e,t){for(;e.toString().length<(t||2);)e="0"+e;return e},s.prototype.spacify=function(e,t){for("string"!=typeof e&&(e=e.toString());e.length<t;)e=" "+e;return e},s.prototype.ftime=function(){var e=new Date,t=r.zerofy(e.getHours()),n=r.zerofy(e.getMinutes()),o=r.zerofy(e.getSeconds()),i=r.zerofy(e.getMilliseconds(),3);return t+":"+n+":"+o+"."+i},s.prototype.fdate=function(){var e=new Date,t=r.zerofy(e.getFullYear(),4),n=r.zerofy(e.getMonth(),2),o=r.zerofy(e.getDate(),2);return t+"-"+n+"-"+o},s.prototype.diff=function(e,t){return e>t?e-t:t-e},s.prototype.escapeRegEx=function(e){var t;return t=String(e).replace(/([\-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},s.prototype.execAll=function(e,t){var n=0,o=e.length;for(n;o>n;n+=1)r.isFunction(e[n])&&e[n](t)},s.prototype.cookie=new i,s.prototype.isNode=function(e){return"Node"===e.constructor.name},s.prototype.isDomElement=function(e){return"object"==typeof window.HTMLElement?e instanceof window.HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},s.prototype.isTextNode=function(e){return 3===e.nodeType},s.prototype.parseHTML=function(e){var t=document.createElement("div");return t.innerHTML=e,t},s.prototype.isDate=function(e){return"undefined"==typeof e?!1:e instanceof Date},s.prototype.isArray=function(e){return"undefined"==typeof e?!1:e instanceof Array||"Array"===e.constructor.name},s.prototype.isObject=function(e){return"undefined"==typeof e||r.isArray(e)?!1:e instanceof Object},s.prototype.isFunction=function(e){return"function"==typeof e},s.prototype.isString=function(e){return"undefined"==typeof e?!1:"string"==typeof e},s.prototype.isNumber=function(e){return"undefined"==typeof e?!1:"number"==typeof e},s.prototype.isBoolean=function(e){return"undefined"==typeof e?!1:"boolean"==typeof e},s.prototype.isEven=function(e){return e%2?!0:!1},s.prototype.isOdd=function(e){return e%2?!1:!0},s.prototype.isDefined=function(e){return"undefined"!=typeof e},s.prototype.matrix=function(e){var t,n=6,o=0,i=function(e){r.log("warn",e+" arguments supplied to kbs.util.matrix, unexpected results may occur")};if(r.isString(e))return-1!==e.indexOf("matrix")?(t=e.match(/\(([^)]+)\)/),t=t[0].replace("(","[").replace(")","]"),t=r.unserialise(t)):t=r.unserialise(e),t;if(r.isArray(e)){for(t="",e.length<6&&i("Insufficient"),e.length>6&&i("Redundant"),e=e.slice(0,6),o=0,n=6;n>o;o+=1)r.isDefined(e[o])||(e[o]=0);return t="matrix("+r.serialise(e).replace("[","").replace("]","")+")"}},s.prototype.capitalise=function(e){var t,n=e.split(" "),o=n.length,i=0;for(i;o>i;i+=1)t=n[i].charAt(0).toUpperCase(),n[i]=t+n[i].slice(1);return n.join(" ")},s.prototype.contains=function(e,t,n){var o,i,s,a=0;if("undefined"==typeof e)return r.log("error","Could not determine a contained value, haystack object is undefined!"),!1;if("undefined"==typeof t)return!1;if(i=function(e,t){return n?(t=r.escapeRegEx(t),o=new RegExp("(\\W|^)"+t+"(\\W|$)"),o.test(e)):-1!==e.indexOf(t)},n=n||!1,r.isArray(e)){for(a=0;a<e.length;a+=1)if(s=r.contains(e[a],t,n),s!==!1)return s}else if(r.isArray(t))for(a=0;a<t.length;a+=1)if(s=r.contains(e,t[a],n),s!==!1)return s;return i(e,t)},s.prototype.swap=function(e,t,n){var o=e[t];e[t]=e[n],e[n]=o},s.prototype.clone=function(e){var t,n,o,i;if(r.isDate(e))return t=new Date,t.setTime(e.getTime()),t;if(r.isArray(e)){for(t=[],o=e.length,i=0;o>i;i+=1)t[i]=r.clone(e[i]);return t}if(r.isObject(e)){t={};for(n in e)e.hasOwnProperty(n)&&(t[n]=r.clone(e[n]));return t}return r.isString(e)||r.isNumber(e)||r.isBoolean(e)?t=e:void r.log("error","Couldn't clone object of unsupported type: "+typeof e)},s.prototype.merge=function(e,t,n){var o,i,s,a;if(r.isObject(e))for(a in t)t.hasOwnProperty(a)&&(i="undefined"!=typeof e[a],(!i||i&&n)&&(r.isObject(t[a])?r.merge(e[a],t[a],n):e[a]=t[a]));if(r.isArray(e))for(o=n,s=t.length,a=0;s>a;a+=1)(!r.contains(e,t[a])||o)&&e.push(t[a]);return e},s.prototype.serialise=function(e,t){var n,o,i,s,a,l=!1;if(t="undefined"!=typeof t?t:!1,o=e,r.isObject(e))if(t)o=JSON.stringify(e);else{o="{",s=r.listProperties(e),l=!0;for(n in e)e.hasOwnProperty(n)&&(o+='"'+n+'":'+r.serialise(e[n],t),s.indexOf(n)===s.length-1&&(l=!1),l&&(o+=", "));o+="}"}if(r.isArray(e)){for(n=0,i=e.length,o="[",n;i>n;n+=1)l=n>0&&n!==i,l&&(o+=", "),a=e[n],o+=r.isString(a)?'"'+a+'"':r.isNumber(a)?a:r.serialise(a,t);o+="]"}return r.isString(e)?'"'+o+'"':o},s.prototype.unserialise=function(e,t){function n(e){var n,o,i,s,a,l=[],c="",u=new RegExp(/(\[)|(\{)/g),d=new RegExp(/(\])|(\})/g),p=!1,f=0,h=0;e=e.replace(/\s,*/g,""),e=e.replace(/,\s*/g,","),e=e.substring(1,e.length-1),i=e.length;do a=e.charAt(h-1),s=e.charAt(h),("'"===s||'"'===s)&&"\\"!==a&&s===n&&(p&&s===n?(p=!1,n=""):p||(p=!0,n=s)),u.test(s)&&!p&&(f+=1),d.test(s)&&!p&&(f-=1),o=(","===s||d.test(s))&&!f&&!p,o||h===i?(l.push(r.unserialise(c,t)),c=""):c+=s,h+=1;while(i>=h);return l}function o(e){var t={};return e=e.replace(/(:\s)/g,":"),e=e.replace(/(\s\{)/g,"{"),e=e.replace(/(\{\s)/g,"{"),e=e.replace(/(\s\})/g,"}"),e=e.replace(/(\}\s)/g,"}"),t}function i(e){var t=/(')|(")/g;if(e.charAt(0).match(t)&&e.charAt(e.length-1).match(t))e=e.substring(1,e.length-1);else{if(isNaN(parseFloat(e,10)))return e;e=parseFloat(e,10)}return e}var s;return t="undefined"!=typeof t?t:!0,s=e,r.isNumber(e)||r.isObject(e)||r.isArray(e)?e:"["===e.charAt(0)?n(e):"{"===e.charAt(0)?t?JSON.parse(e):o(e):r.isString(e)?i(e):s},s.prototype.listProperties=function(e){var t,n=[];if(r.isObject(e)){for(t in e)e.hasOwnProperty(t)&&n.push(t);return n}},s.prototype.sizeof=function(e){var t,n,o=0;if(null!==e&&void 0!==e)switch(typeof e){case"string":o+=2*e.length;break;case"number":o+=8;break;case"boolean":o+=4;break;case"object":if(r.isObject(e))for(n in e)e.hasOwnProperty(n)&&(o+=r.sizeof(e[n]));if(r.isArray(e))for(t=e.length,n=0;t>n;n+=1)o+=r.sizeof(e[n])}return o},s.prototype.bytesFormat=function(e){return 1014>e?e+"bytes":1048576>e?(e/1024).toFixed(3)+"KB":1073741824>e?(e/1048576).toFixed(3)+"MB":(e/1073741824).toFixed(3)+"GB"},s.prototype.log=function(i,s,a,l){function c(){l=a,a=s,s=i}if(e.logs.enabled){o.logCount+=1;var u,d=0,p=[],f=e.logs.filter,h=[],m="",g=!1,y=!1,v="",b="",k="",w=e.logs.contextFlag,x=e.logs.contextClearFlag;for(u in arguments)arguments.hasOwnProperty(u)&&p.push(arguments[u]);if(e.logs.contexts?"string"==typeof i?-1!==i.indexOf(w)?r.log.currentContext!==!1?(y=i.replace(w,""),i=r.log.currentContext,p.shift()):(i=i.replace(w,""),p.shift()):-1!==i.indexOf(x)?p.shift():(c(),i=r.log.currentContext):(c(),i=r.log.currentContext):(-1!==i.indexOf(w)?p.shift():c(),i=!1,y=!1),p.length>2?"object"==typeof a&&(g=a,a=l):p.length>1?"object"==typeof s?(g=s,s="log"):"object"==typeof a&&(g=a,a=""):(a=s,s="log","object"==typeof a&&(g=a,a="")),!f||r.contains(f,s,!0)===!1)for(m+=r.ftime(),m+=" ["+(y||i||e.appName)+"]",m+=" ["+s+"]:> ",m+=a,h.push(m),g&&(b="Object "+JSON.stringify(g,null,4)),k=m.replace(/\s/g," "),k=encodeURIComponent(k),k+=e.logs.obj2buffer?""!==b?"\n"+b:"":""!==b?"\n[object omitted]":"",k+="\n",o.console.writeToBuffer(k),e.logs.gui&&n.console&&(v=m.replace(/\s/g," "),t.publish("gui/log",{msg:v,type:s,obj:b,context:i,subcontext:y})),window.console[s]||(s="log"),g&&h.push(g);d<h.length;)window.console[s](h[d]),d+=1}},s.prototype.log.currentContext=r.log.currentContext||!1,s.prototype.log.beginContext=function(t){return e.logs.contexts?-1!==t.indexOf(e.logs.contextFlag)?void r.log("error","You shouldn't pass the context flag when using beginContext()"):void(r.log.currentContext=t):void 0},s.prototype.log.endContext=function(){r.log.currentContext=!1},s.prototype.log.clearContext=function(e){t.publish("gui/contexts/clear",e)},s.prototype.debug=function(){r.log("debug")},s.prototype.warn=function(){r.log("warn")},s.prototype.error=function(){r.log("error")},r.log("+ util.js loaded"),r}),define("main/components/exception",["main/components/util"],function(e){function t(t,n){this.fileName=t.fileName,this.lineNumber=t.lineNumber,this.message=t.message,e.log("error",n+" | Exception thrown in "+t.fileName+" at line "+t.lineNumber+". Error: "+t.message)}return t}),define("main/components/repository",[],function(){function e(){}var t={};return e.prototype.add=function(e,n){if(t[e])throw new Error("Couldn't add '"+e+"' to the repository,  key already exists. Delete the key first.");t[e]=n},e.prototype.get=function(e){return t[e]},e.prototype.del=function(e){delete t[e]},e.prototype.all=function(){return t},e}),define("main/components/counter",[],function(){function e(e,t){var n=0,o=!1;this.target=e,this.exec=t,Object.defineProperty(this,"count",{get:function(){return n},set:function(t){n=t,n>=e&&!o&&(o=!0,this.exec())}})}return e}),define("main/components/http",["config","main/components/util","main/components/counter"],function(e,t){function n(e){this.url=e.url,this.method=e.method||"GET",this.async=e.async||!0,this.data=e.data,this.callbacks={},this.callbacks.success=e.success||function(){},this.callbacks.fail=e.fail||function(){},o=this,e.send&&this.send(this.data)}var o,i=e.httpToken;return n.prototype.encodeData=function(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&(n+=t+"="+e[t]+"&");return i&&(n+="kbstoken="+i),n},n.prototype.send=function(){var e=new XMLHttpRequest;e.open(this.method,this.url,this.async),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4===this.readyState&&(200===this.status&&this.status<400?(t.log("debug","HTTP 200: "+o.url),o.callbacks.success(this.responseText)):(t.log("debug","HTTP "+this.status+": "+o.url),o.callbacks.fail(this.responseText)))},e.send(o.encodeData(o.data)),e=null},n}),define("main/components/viewloader",["require"],function(e){function t(){}return t.prototype.load=function(t,n){e(["main/views/"+t],function(e){n(e)})},t}),define("main/ui/node",["config","main/components/util"],function(e,t){function n(e,i,s){if(t.isString(e)&&("#"===e.charAt(0)||"."===e.charAt(0)))return new n(document.querySelector(e),i,s);var r=(o.length,this.findAssociatedNode(e));return r?r:(o.push(this),this.children=[],this.textNodes=[],void(t.isDomElement(e)?this.element=e:(this.settings={type:e,classes:i,id:s},this.element=document.createElement(e),this.element.className=i||"",s&&(this.element.id=s))))}var o=[];return n.prototype.show=function(){return this.element.style.display="block",this},n.prototype.hide=function(){return this.element.style.display="none",this},n.prototype.toggle=function(){var e="none"===this.element.style.display?"block":"none";return this.element.style.display=e,this},n.prototype.fadeIn=function(e){return"undefined"==typeof window.jQuery?(this.show(),this):(window.jQuery(this.element).fadeIn(e),this)},n.prototype.fadeOut=function(e){return"undefined"==typeof window.jQuery?(this.hide(),this):(window.jQuery(this.element).fadeOut(e),this)},n.prototype.getId=function(){return this.element.id},n.prototype.getClasses=function(){return this.element.className},n.prototype.hasClass=function(e){var n,o,i=!1;if(t.isArray(e))for(o=e.length,n=0;o>n;n+=1)-1!==this.element.className.indexOf(e[n])&&(i=!0);else-1!==this.element.className.indexOf(e)&&(i=!0);return i},n.prototype.addClass=function(e){-1===this.element.className.indexOf(e)&&(""===this.element.className?this.element.className=e:this.element.className+=" "+e)},n.prototype.removeClass=function(e){var n,o,i=this.element.className,s=function(e){n=-1!==i.indexOf(" "+e)?i.replace(" "+e,""):-1!==i.indexOf(e+" ")?i.replace(e+" ",""):i.replace(e,"")};if(t.isArray(e))for(n=i,o=0;o<e.length;o+=1)this.removeClass(e[o]);else s(e);this.element.className=n},n.prototype.setClass=function(e){this.element.className=e},n.prototype.toggleClass=function(e){this.hasClass(e)?this.removeClass(e):this.addClass(e)},n.prototype.css=function(e,n){var o,i=e.split("-");if(i.length>1)for(o=1;o<i.length;o+=1)i[o]=t.capitalise(i[o]);return e=i.join(""),"undefined"==typeof n||""===n?window.getComputedStyle(this.element,null).getPropertyValue(e):(this.element.style[e]=n,this)},n.prototype.getComputedStyle=function(e){return window.getComputedStyle(this.element,null).getPropertyValue(e)},n.prototype.parent=function(){return this.element?this.element.parentNode:null},n.prototype.addChild=function(e){return e.constructor===n||e instanceof n?(this.element.appendChild(e.element),this.children.push(e),e):t.isDomElement(e)?(e=new n(e),this.addChild(e)):t.isTextNode(e)?(this.textNodes.push(e),this.element.appendChild(e),e):void t.log("error",this,"Attempt to add a child element to Node failed, child is not of type Node or HTMLElement.")},n.prototype.createChild=function(e,t,o){var i=new n(e,t,o);return this.addChild(i),i},n.prototype.detach=function(){return this.element.parentNode.removeChild(this.element)},n.prototype.attach=function(){this.element.parentNode.appendChild(this.element)},n.prototype.move=function(e){var n=this.detach();t.isNode(e)?e.addChild(n):t.isDomElement(e)&&e.appendChild(n)},n.prototype.translate=function(e,n){var o,i=this.css("transform");"none"===i?o=[0,0,0,0,e,n]:(o=t.matrix(i),o[4]=e,o[5]=n),o=t.matrix(o),this.css("transform",o)},n.prototype.scale=function(e){var n,o=this.css("transform");"none"===o?n=[e,0,0,e,0,0]:(n[0]=e,n[3]=e),n=t.matrix(n),this.css("transform",n)},n.prototype.getBounds=function(e){var n=this.element.getBoundingClientRect();return"center"===e?t.diff(n.left,n.right)/2:n[e]},n.prototype.destroy=function(){var e=this.children.length,t=o.length,n=0,i=0;if(e)for(n;e>n;n+=1)this.children[n]&&(this.children[n].destroy(),this.children[n]=null);if(t)for(i;t>i;i+=1)o[i]&&o[i].element===this.element&&o.splice(i,1);return this.parent()?void this.parent().removeChild(this.element):void(this.element=null)},n.prototype.find=function(e){var t=this.element.querySelectorAll(":scope "+e),o=t.length,i=[],s=0;for(s;o>s;s+=1)i.push(new n(t[s]));return i},n.prototype.clear=function(){var e=0,t=this.children.length;for(e;t>e;e+=1)this.children[e].destroy()},n.prototype.clone=function(){var e=new n(this.settings.type,this.getClasses(),this.getId());return e.element=null,e.element=this.element.cloneNode(),e},n.prototype.focus=function(){return this.element.focus(),this},n.prototype.attr=function(e,t){return"undefined"==typeof t?this.element.getAttribute(e):(this.element.setAttribute(e,t),this)},n.prototype.text=function(e,t){return"undefined"==typeof e?this.element.textContent||this.element.value:(t&&(this.element.textContent="",this.element.value=""),e=document.createTextNode(e),this.addChild(e),this)},n.prototype.val=function(e){return"undefined"==typeof e?"SELECT"===this.element.nodeName?this.element.selectedOptions[0].value:this.element.value:(this.element.value=e,this)},n.prototype.on=function(e,t){return this.element.addEventListener(e,t),this},n.prototype.off=function(e,t){return this.element.removeEventListener(e,t),this},n.prototype.writeTo=function(e){"undefined"!=typeof e&&e.appendChild(this.element)},n.prototype.hasChildren=function(){return this.children.length},n.prototype.is=function(e){return this.element===e},n.prototype.findAssociatedNode=function(e){var t=o.length,n=0;for(n;t>n;n+=1)if(o[n].element===e)return o[n];return!1},n.prototype.count=function(){return o.length},n.prototype.ALL_NODES=o,n}),define("main/ui/modal",["config","main/components/util","main/components/events","main/components/status","main/components/repository","main/components/http","main/components/viewloader","main/ui/node"],function(e,t,n,o,i,s,r,a){function l(e,n){t.log("context:gui","debug","Modal '"+e.viewName+"' event '"+n+"' fired")}function c(){this.list={},this.active=null,this.stacked=[],this.opened=[],n.subscribe(["gui/modal/open","gui/modal/close","gui/modal/destruct"],this.processStack.bind(this)),this.events=["init","load","reload","open","close","destruct","confirm","proceed","cancel"];var e=this.events.length,t=0;for(t;e>t;t+=1)n.subscribe("gui/modal/"+this.events[t],l)}function u(e,t){if(t=t||{init:!0},"undefined"==typeof t.init&&(t.init=!0),p.exists(e)){var n=p.getModalByName(e);return p.isStacked(n)?(p.swapStack(n),n):(t.init&&n.init(),n)}this.viewName=e,this.viewParams=t.viewParams||{},this.params=t,this.classes=t.classes||"",this.inited=!1,this.loaded=!1,this.createEvents(),this.node=new a("div","kbs-modal kbs-"+e),this.node.addClass(this.classes),this.node.hide(),this.shieldNode=this.node.createChild("div","kbs-modal-shield"),this.view=null,this.init=this.rInit.bind(this),this.open=this.rOpen.bind(this),this.close=this.rClose.bind(this),this.destroy=this.rDestroy.bind(this),this.applyHandlers(t),this.load(t.init?this.init:function(){}),p.addModal(this)}var d,p,f=new r;return c.prototype.processStack=function(e,n){var i=this.active,s=this.opened,r=this.stacked,a=e;t.log("context:gui","debug","processing modal stack"),"gui/modal/open"===n&&(i&&!i.dueRemoval&&this.addToStack(i),this.addToOpened(a)),"gui/modal/close"===n&&(this.isStacked(a)&&this.removeFromStack(a),r.length?(a=r[r.length-1],a.open(),this.removeFromStack(a)):s.length||(this.active=null,d.preserveOverlay=!1,o.interactor.taskDetailsExpanded||d.hideOverlay()),this.removeFromOpened(a)),(r.length||s.length)&&(d.preserveOverlay=!0)},c.prototype.addToStack=function(e,n){t.log("context:gui","debug","Adding modal '"+e.viewName+"' to stack"),e.node.addClass("kbs-stacked"),n?this.stacked[n]=e:this.stacked.push(e),this.shiftStack()},c.prototype.removeFromStack=function(e){var n=this.stacked,o=n.indexOf(e);this.stacked.splice(o,1),e.node.removeClass("kbs-stacked"),this.shiftStack(),t.log("context:gui","debug","Removed modal '"+e.viewName+"' from stack")},c.prototype.shiftStack=function(){var e,n,o=this.stacked,i=o.length,s=0;if(this.getBehaviour("shift"))for(t.log("context:gui","debug","shifting stack"),s;i>s;s+=1)e=o[s],e.node.removeClass("kbs-shift-left"),e.node.removeClass("kbs-shift-right"),0!==s&&(t.isEven(s)&&(n="kbs-shift-left"),t.isOdd(s)&&(n="kbs-shift-right"),e.node.addClass(n),t.log("context:gui","debug","set offset of "+n+" to '"+e.viewName+"'"))},c.prototype.swapStack=function(e){var n,o=this.active,i=(this.opened,this.stacked);return t.isNumber(e)?void(n=i[e]):(t.isString(e)&&(n=this.getModalByName(e)),t.isObject(e)&&(n=e),this.removeFromStack(n),this.shiftStack(),this.addToStack(o),void(this.active=n))},c.prototype.getStackIndex=function(e){var t=this.stacked,n=t.length,o=0;for(o;n>o;o+=1)if(t[o]===e)return o},c.prototype.addModal=function(e){this.list[e.viewName]=e},c.prototype.removeModal=function(e){delete this.list[e.viewName||e]},c.prototype.addToQueue=function(e){this.queued.push(e)},c.prototype.removeFromQueue=function(e){var t=this.queued,n=t.indexOf(e.viewName||e);this.queued.splice(n,1)},c.prototype.addToOpened=function(e){this.opened.push(e)},c.prototype.removeFromOpened=function(e){var t=this.opened,n=t.indexOf(e.viewName||e);this.opened.splice(n,1)},c.prototype.isActive=function(e){return this.active===e},c.prototype.isOpen=function(e){return-1!==this.opened.indexOf(e)},c.prototype.isQueued=function(e){return-1!==this.queued.indexOf(e)},c.prototype.isStacked=function(e){return-1!==this.stacked.indexOf(e)},c.prototype.getModalByName=function(e){return this.list[e]},c.prototype.exists=function(e){var t=!1,n=this.getModalByName(e);return"undefined"!=typeof n&&null!==n&&(t=!0),t},c.prototype.getBehaviour=function(t){return e.gui.modals.behaviour[t]},p=new c,u.prototype.createEvents=function(){var e,t=0,o=p.events.length,i=function(){};for(this.eventName={},t;o>t;t+=1)this.eventName[p.events[t]]="gui/modal/"+this.viewName+t;for(e in this.eventName)this.eventName.hasOwnProperty(e)&&n.subscribe(this.eventName[e],i)},u.prototype.load=function(e){var n,o=this,i=this.viewParams;this.loaded||(this.loaded=!0,f.load("modals/"+this.viewName,function(s){n=s.draw([d,o,i]),o.view=n,o.viewModule=s,o.title=n.title,o.trigger("load",o),t.isFunction(e)&&e()}))},u.prototype.reload=function(e){var t=this,n=this.viewModule,o=n.draw([d,t,t.viewParams],e),i=this.node.find(".kbs-modal-content")[0];i.clear(),i.addChild(o),this.trigger("reload",this)},u.prototype.on=function(e,o){try{n.subscribe(this.eventName[e],o)}catch(i){t.log("error","Modal handler attachment failed with: "+i.message)}},u.prototype.off=function(e,o){try{n.unsubscribe(this.eventName[e],o)}catch(i){t.log("error","Modal handler removal failed with: "+i.message)}},u.prototype.trigger=function(e,t){n.publish("gui/modal/"+e,t),n.publish(this.eventName[e],t)},u.prototype.hide=function(){this.node.hide()},u.prototype.show=function(){this.node.show()},u.prototype.applyHandlers=function(){var e=this,n=function(n){t.log("warn","Modal '"+e.viewName+"' event '"+n+"' ran but didn't have a handler!")},o=this.params;this.shieldNode.on("click",function(){p.swapStack(e.viewName)}),this.on("confirm",o.confirm||function(){n("confirm")}),this.on("cancel",o.cancel||function(){n("cancel")}),this.on("proceed",o.proceed||function(){n("proceed")})},u.prototype.rInit=function(){if(this.inited)return this.open(),this;var e=this.node,t=this,n=e.createChild("h2","kbs-modal-title"),o=e.createChild("i","fa fa-times kbs-modal-closed"),i=e.createChild("p","kbs-modal-content");n.text(this.title),o.on("click",function(){t.dueRemoval=!0,t.close()}),i.addChild(this.view),d.addChild(e),this.inited=!0,this.trigger("init",this),this.open()},u.prototype.rOpen=function(){return p.isActive(this)?void 0:this.inited?(this.dueRemoval=!1,d.showOverlay(),this.node.fadeIn(),this.trigger("open",this),p.active=this,this):this.init()},u.prototype.rClose=function(){this.node.hide(),p.removeFromOpened(this),this.trigger("close",this)},u.prototype.rDestroy=function(){p.isOpen(this)&&this.rClose(),this.inited=!1,this.loaded=!1,p.removeModal(this),this.trigger("destruct",this),this.node.destroy()},u.prototype.setInstance=function(e){d=e},u.prototype.getController=function(){return p},u}),define("main/components/configurator",["config","main/components/util","main/ui/modal"],function(e,t,n){function o(){return i?i:(i=this,this.modal=null,this.launchModal=this.rLaunchModal.bind(this),void(this.reloadModal=this.rReloadModal.bind(this)))}var i,s={};return o.prototype.getUserData=function(){var e=t.cookie.get("settings"),n=t.unserialise(e);return n||{}},o.prototype.getUserCookie=function(){return t.cookie.get("settings")},o.prototype.getFormattedUserCookie=function(){return JSON.stringify(s,null,4)},o.prototype.loadExisting=function(){var n=this.getUserData();return n?(t.log("loading existing user config"),s=n,void t.merge(e,n,!0)):void t.log("error","no user data found!")},o.prototype.modifiedProperties=function(){var e,t=[];for(e in s)s.hasOwnProperty(e)&&t.push(e);return t},o.prototype.rLaunchModal=function(){this.modal?this.modal.init():this.modal=new n("user-config",{init:!0})},o.prototype.rReloadModal=function(){this.modal&&this.modal.reload()},o.prototype.get=function(t){var n=0,o=t.split("/"),i=e,s=o.length;for(n;s>n;n+=1)i=i[o[n]];return i},o.prototype.set=function(n,o,i){var r,a,l=n.split("/"),c=l.length,u=e,d=0,p=s;if(i=i||!1,1===c)return e[n]=o,s[n]=o,t.cookie.set("settings",t.serialise(s)),i&&this.modal.reload(!0),e[n];for(d;c>d;d+=1)d===c-2&&(r=u[l[d]],a=l[d]),u=u[l[d]],d!==c-1?(p[l[d]]=p[l[d]]||{},p=p[l[d]]):p[l[d]]=o;return r[l[c-1]]=o,t.cookie.set("settings",t.serialise(s)),i&&this.modal.reload(!0),r[l[c-1]]},o.prototype.reset=function(){e.reset(),t.cookie.del("settings"),location.hash="settings",location.reload()},o}),define("main/components/bugherd",["config","main/components/util","main/components/cache","main/components/status","main/components/repository","main/ui/node"],function(e,t,n,o,i,s){function r(){this.api=p.application.tasksCollection,this.baseApi=c,this.setSeverityStyle=this.rSetSeverityStyle.bind(this),this.setAllSeverityStyles=this.rSetAllSeverityStyles.bind(this)}function a(){return c?c:(c=this,l=l||d.get("interactor"),u=u||d.get("gui"),this.api=p,this.tasks=new r,void this.init())}{var l,c,u,d=new i,p=window.bugherd;window.jQuery}return r.prototype.init=function(){var t=this;this.applyHandlers(),e.gui.severityStyles&&(setTimeout(function(){t.setAllSeverityStyles()},100),p.application.on("change",function(){setTimeout(t.setAllSeverityStyles,100)}))},r.prototype.findModelByLocalId=function(e){var t=this.baseApi.tasks(),n=t.length,o=0;for(o;n>o;o+=1)if(t[o].attributes.local_task_id===e)return t[o]},r.prototype.findModelByGlobalId=function(e){var t=this.baseApi.tasks(),n=t.length,o=0;for(o;n>o;o+=1)if(t[o].id===e)return t[o]},r.prototype.getBrowserInfo=function(e,n){return t.isObject(e)||t.isNumber(e)||t.log("error","Unable to get task from parameter of type "+typeof e),t.isNumber(e)&&(e=e>1e6?this.findModelByGlobalId(e):this.findModelByLocalId(e)),e.attributes.browser_info[n]||e.attributes.browser_info},r.prototype.getMeta=function(e){return t.isNumber(e)&&(e=e>1e6?this.findModelByGlobalId(e):this.findModelByLocalId(e)),e.attributes.data.userMetaData},r.prototype.findAllWithMeta=function(e,n){return this.match(function(o){var i=o.getData().userMetaData||{};return t.isDefined(i[e])&&(i[e]===n||t.contains(i[e],n))?!0:!1})},r.prototype.findAllWithClientData=function(e,n){return this.match(function(o){var i=o.getBrowserData()||{};return t.isDefined(i[e])&&(i[e]===n||t.contains(i[e],n))?!0:!1})},r.prototype.findAllWithTag=function(e){return this.match(function(n){var o=n.attributes.tag_names;return t.contains(o,e)?!0:!1})},r.prototype.match=function(e){var t,n=this.api.models,o=n.length,i=[],s=0;for(s;o>s;s+=1)t=n[s],e(t)&&i.push(t);return i},r.prototype.applyHandlers=function(){var e=this,i=this.baseApi,s=function(e,o,s){var r,a=e.attributes.requester_name,l=e.attributes.local_task_id,c=e._previousAttributes.status_id,u=e.attributes.status_id,d=i.getStatusFromId(c),p=i.getStatusFromId(u),f=e.attributes.priority_id,h=i.getPriorityFromId(f);r=s.replace("${user}",a),r=r.replace("${id}",l),r=r.replace("${prevStatus}",d),r=r.replace("${status}",p),r=r.replace("${severity}",h),t.log("context:bugherd",o,e,r),n.RECENT_TASK=e};this.on("add",function(t){s(t,"okay","Task '#${id}' created by '${user}'"),e.setAllSeverityStyles()}),this.on("remove",function(t){s(t,"warn","Task '#${id}' was deleted"),o.interactor.taskDetailsExpanded&&parseInt(l.activeTask,10)===t.attributes.local_task_id&&l.closeTask(),e.setAllSeverityStyles()}),this.on("refresh",function(t){s(t,"info","Task '#${id}' refreshed"),e.setAllSeverityStyles()}),this.on("change:status_id",function(t){s(t,"info","Task '#${id}' moved from '${prevStatus}' to '${status}'"),e.setAllSeverityStyles()}),this.on("change:priority_id",function(t){s(t,"info","Task '#${id}' set to '${severity}'"),e.setAllSeverityStyles()})},r.prototype.on=function(e,t){this.api.on(e,t)},r.prototype.rSetSeverityStyle=function(e){var t;e=new s(document.querySelector("#task_"+e)),t=e.find(".task-severity"),t.length&&(t=t[0].element.className.replace("task-severity","").replace(/\s/g,""),e.addClass(t))},r.prototype.rSetAllSeverityStyles=function(){var e,t=document.querySelectorAll(".task"),n=t.length,o=0;for(o;n>o;o+=1)e=t[o].id.replace("task_",""),e&&this.setSeverityStyle(e)},a.prototype.init=function(){this.tasks.init(),this.applyContext(),this.applyHandlers()},a.prototype.applyHandlers=function(){},a.prototype.applyContext=function(){t.log("context:bugherd","buffer","log-buffer: BUGHERD-API")},a.prototype.on=function(e,t){p.application.on(e,t)},a.prototype.trigger=function(e){p.application.trigger(e)},a.prototype.getStatusFromId=function(e){var t={"null":"feedback",0:"backlog",1:"todo",2:"doing",4:"done",5:"archive"};return t[e]},a.prototype.getPriorityFromId=function(e){var t={0:"not set",1:"critical",2:"important",3:"normal",4:"minor"};return t[e]},a.prototype.getTasks=function(){return p.application.tasksCollection.models
},a}),define("main/components/router",["config"],function(e){var t={"console/save":e.routes.console.save},n=window.KBS_BASE_URL;return{getRoute:function(o,i){return"undefined"==typeof i?n+t[o]:n+e.routes[o][i]}}}),define("main/ui/console",["config","main/components/util","main/components/events","main/components/http","main/components/status","main/components/router","main/components/cache","main/components/configurator","main/ui/node","main/ui/modal"],function(e,t,n,o,i,s,r,a,l,c){function u(t){if(e.logs.gui){if(d=this,"undefined"==typeof t)throw new Error("No GUI instance passed to Console");this.tools={},p=t,this.buildNodeTree(),this.setContexts(),this.logs=[],n.subscribe("gui/contexts/clear",function(e){d.clearContext(e)}),n.publish("kbs/status",{component:"console",status:!0})}}var d,p,f=new a;return u.prototype.setContexts=function(){this.contexts||(this.contexts={def:d.wrapper.cons.out})},u.prototype.getContext=function(t){return e.logs.contexts?this.contexts[t]:this.contexts.def},u.prototype.createContext=function(n,o){if(e.logs.contexts){var i;return this.contexts[n]&&t.log("error","Log context: '"+n+"' is already defined"),t.isNode(o)?i=o.createChild("div","kbs-log-context",n):(i=new l("div","kbs-log-context","kbs-ctx-"+n),o.appendChild(i.element)),this.contexts[n]=i,i}},u.prototype.clearContext=function(e){"def"!==e&&(d.contexts[e]=null,delete d.contexts[e])},u.prototype.write=function(e){var n,o,i=d.getContext("def"),s=new l("div","kbs-log-node kbs-"+e.type),r=document.createTextNode(e.msg),a=new l("pre","kbs-object"),c=new l("i","fa fa-"+d.getIcon("expand")+" kbs-object-expand"),u=!1;e.context&&(e.subcontext?d.getContext(e.subcontext)?i=d.getContext(e.subcontext):(i=d.getContext(e.context),u=e.subcontext):d.getContext(e.context)?i=d.getContext(e.context):u=e.context),s.addChild(r),e.obj&&(o=document.createTextNode(e.obj),c.element.onclick=function(e){var n=e.target,o=n.parentNode;t.contains(o.className,"kbs-expand")?(o.className=o.className.replace(" kbs-expand",""),n.className=n.className.replace(" kbs-rotate","")):(o.className+=" kbs-expand",n.className+=" kbs-rotate")},a.addChild(c),a.addChild(o),s.addChild(a)),i.parentNode&&(n=i.parentNode.className,e.type.match(/(test)|(buffer)/)&&t.contains(n,"kbs-exec")&&s.addClass("kbs-log-closed")),i.addChild(s),d.logs.push(s),u&&d.createContext(u,s),d.scrollToElement(s.element)},u.prototype.createTool=function(t){var n,o=this.wrapper.constools;if("undefined"==typeof o)throw new Error("Could not create new tool, no toolbar!");return n=this.getIcon(t),o[t]=o.createChild("i","fa fa-"+n+" kbs-tool kbs-"+t),o[t].element.title=e.tooltips[t]||"",this.tools[t]=o[t],o[t]},u.prototype.removeTool=function(e){this.tools[e].destroy()},u.prototype.getIcon=function(t){return e.gui.console.icons[t]||"plus"},u.prototype.open=function(){d.wrapper.removeClass("kbs-closed"),d.wrapper.addClass("kbs-open")},u.prototype.close=function(){d.wrapper.removeClass("kbs-open"),d.wrapper.addClass("kbs-closed")},u.prototype.scrollToElement=function(e){var t=d.wrapper.cons.element;t.scrollTop=e.offsetTop},u.prototype.toggleObjectLogs=function(){var e,t=document.querySelectorAll(".kbs-object"),n=t.length,o=0;for(o;n>o;o+=1)e="none"!==t[o].style.display,t[o].style.display=e?"none":"block"},u.prototype.clear=function(){var e,n=d.wrapper.cons.element,o=d.wrapper.cons.out.element,i=(new Date).getTime(),s=d.logs,a=s.length,l=0,c=0;for(n.removeChild(o),c;a>c;c+=1)s[c].destroy(),l+=1;n.appendChild(o),e=(new Date).getTime()-i,t.log("okay","cleared "+l+" logs in "+e+" ms"),r.console.clearBuffer(),r.logCount=0},u.prototype.save=function(){var e,n=(t.ftime(),t.fdate()),i=r.console.getBuffer();t.log.beginContext("log/save"),t.log("info","saving log buffer..."),e=new o({url:s.getRoute("console/save"),method:"POST",send:!0,data:{type:"log",date:n,buffer:i},success:function(e){t.log("context:log/save","okay",e),t.log.endContext(),t.log.clearContext("log/save")}})},u.prototype.destroy=function(){var e=new c("console-destruct",{init:!0,confirm:function(){d.commitDestroy(e,"hard")},cancel:function(){e.close()}})},u.prototype.commitDestroy=function(e,t){if("hard"===t){var n=d.wrapper.cons.parent(),o=d.wrapper.cons.element;r.console.parent=n,r.console.child=o,n.removeChild(o)}i.console=!1,r.console.clearBuffer(),d.wrapper.addClass("kbs-disabled"),d.removeTool("destroy"),e&&e.close(),f.set("gui/console/destroyed",!0)},u.prototype.restore=function(){this.wrapper.removeClass("kbs-disabled")},u.prototype.buildNodeTree=function(){var t,n,o,i,s,r,a,l=-1!==window.KBS_BASE_URL.indexOf("localhost")?"local":"remote";return n="kbs-cons-box "+e.gui.console.state,this.wrapper=t=p.createChild("div",n),e.logs.enabled||t.addClass("kbs-disabled"),o=t.constools=t.createChild("div","kbs-cons-toolbar"),i=o.constitle=o.createChild("div","kbs-cons-title"),s=document.createTextNode(e.appFullname+" v"+e.version+" - "+l),i.addChild(s),e.logs.enabled&&(this.createTool("menu").on("click",function(){var e=t.hasClass("kbs-closed"),n=t.hasClass("kbs-full");e||n||t.addClass("kbs-full"),n&&t.removeClass("kbs-full"),e&&d.open()}),this.createTool("toggle").on("click",function(){var e=f.get("gui/console/displayed");t.toggleClass("kbs-disabled"),f.set("gui/console/displayed",e?!1:!0)}),-1!==window.KBS_BASE_URL.indexOf("localhost")&&this.createTool("save").on("click",d.save),this.createTool("benchmark").on("click",d.benchmark),this.createTool("toggleObjs").on("click",d.toggleObjectLogs),e.gui.console.allowDestruction&&this.createTool("destroy").on("click",d.destroy),this.createTool("clear").on("click",d.clear)),this.createTool("settings").on("click",f.launchModal),e.logs.enabled&&this.createTool("close").on("click",d.close),t.cons=r=t.createChild("div","kbs-cons"),e.logs.enabled||r.hide(),a=r.out=r.createChild("div","kbs-cons-out"),e.gui.console.destroyed&&this.commitDestroy(!1,"hard"),e.gui.console.displayed||this.wrapper.addClass("kbs-disabled"),t},u.prototype.benchmark=function(){var n,o,i,s=d.wrapper.cons.element,r=d.wrapper.cons.out.element,a=e.gui.console.benchmark.amount,l=(new Date).getTime(),c=0;for(t.log("context:benchmark","exec","executing benchmark..."),t.log.beginContext("benchmark"),s.removeChild(r),t.log("context:benchmark/output","buffer","benchmark output...");a>c;)t.log("context:benchmark/output","debug","log #"+(c+1)),c+=1;s.appendChild(r),n=(new Date).getTime()-l,o=Math.floor(a/n*1e3),i="Logged "+a+" messages in "+n+"ms",t.log("context:benchmark","okay",i),t.log("okay",o+" logs per second."),t.log.endContext(),d.clearContext("benchmark"),d.clearContext("benchmark/output")},u}),define("main/ui/gui",["config","main/components/util","main/components/events","main/components/status","main/components/counter","main/components/configurator","main/ui/node","main/ui/console","main/ui/modal"],function(e,t,n,o,i,s,r,a,l){function c(){u=this,l.prototype.setInstance(this),this.applyContext(),this.setModalApi(),this.tree=this.buildNodeTree(),this.console=new a(this),this.preserveOverlay=!1,this.init(),n.publish("kbs/status",{component:"gui",status:!0})}var u,d=new s;return t.log("+ gui.js loaded"),c.prototype.init=function(){var o=new i(e.offline?2:3,function(){n.publish("kbs/gui/loaded")}),s=document.createElement("link"),r=document.createElement("link"),a=document.createElement("link"),l=window.KBS_BASE_URL+"css/main.css",c=window.KBS_BASE_URL+"css/themes/"+(e.theme||"default")+".css",d="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css",p=function(){document.body.appendChild(u.tree.main.element),t.log("context:gui/init","+ attached gui tree"),u.runEventListeners(),u.loadWallpaper(),n.publish("kbs/loaded")};e.gui.enabled&&(e.logs.gui&&n.subscribe("gui/log",this.console.write),n.subscribe("kbs/gui/loaded",p)),s.rel="stylesheet",r.rel="stylesheet",a.rel="stylesheet",s.href=l,r.href=c,a.href=d,r.id="kbs-theme-link",t.log("context:gui/init","info","Initialising GUI..."),s.onload=function(){t.log("context:gui/init","+ main.css loaded"),o.count+=1},s.onerror=function(){throw o.count+=1,new Error("main.css failed to load!")},r.onload=function(){var e=u.getThemeName();t.log("context:gui/init","+ theme '"+e+"' loaded"),o.count+=1},r.onerror=function(){o.count+=1,t.log("error","theme '"+u.getThemeName()+"' failed to load!")},a.onload=function(){t.log("context:gui/init","+ font-awesome.css loaded"),o.count+=1},a.onerror=function(){throw o.count+=1,new Error("font-awesome.css failed to load!")},e.offline||document.head.appendChild(a),document.head.appendChild(s),document.head.appendChild(r)},c.prototype.applyContext=function(){n.subscribe("kbs/gui/loaded",function(){t.log("context:gui","buffer","log-buffer: GUI")})},c.prototype.getThemeName=function(e){var t=document.getElementById("kbs-theme-link"),n=e||t.href;return n=n.replace(window.KBS_BASE_URL+"css/themes/",""),n=n.replace(".css","")},c.prototype.resetTheme=function(){u.loadTheme(e.theme||"theme")},c.prototype.loadTheme=function(e){var t=document.getElementById("kbs-theme-link"),n=new r(t);e=e.replace(".css",""),n.attr("href",window.KBS_BASE_URL+"css/themes/"+e+".css"),d.set("theme",e)},c.prototype.unloadTheme=function(){var e=document.getElementById("kbs-theme-link"),t=new r(e);t.attr("href","")},c.prototype.loadWallpaper=function(t){var n=new r(document.getElementById("kanbanBoard"));t=t||e.gui.wallpaper,t="url('"+t+"')",n.css("background-image",t)},c.prototype.showOverlay=function(){o.gui.overlay||(u.tree.main.overlay.fadeIn(),o.gui.overlay=!0)},c.prototype.hideOverlay=function(){o.interactor.taskDetailsExpanded||u.preserveOverlay||(u.tree.main.overlay.fadeOut(),o.gui.overlay=!1)},c.prototype.buildNodeTree=function(){var e,t={};return t.main=e=new r("div","kbs-gui"),e.overlay=e.createChild("div","kbs-overlay"),t},c.prototype.runEventListeners=function(){t.log("context:gui/init","+ running event listeners");var n,o,i=this.console.wrapper.cons.out.element;o=e.logs.contexts?["kbs-exec","kbs-test","kbs-buffer"]:"",i.onclick=function(e){n=new r(e.target),n.hasClass(o)&&(n.hasClass("kbs-log-closed")?n.removeClass("kbs-log-closed"):n.addClass("kbs-log-closed"))}},c.prototype.setModalApi=function(){this.modals=l.prototype.getController()},c.prototype.addChild=function(e){this.tree.main.addChild(e)},c.prototype.createChild=function(e,t,n){var o=new r(e,t,n);return this.addChild(o),o},c.prototype.getCurrentInstance=function(){return u},c}),define("main/ui/interactor",["config","main/components/util","main/components/events","main/components/status","main/components/repository","main/components/configurator","main/ui/node","main/ui/modal"],function(e,t,n,o,i,s,r,a){function l(){t.log("context:inter/init","info","Initialising Interactor..."),u=this,d=h.get("gui"),this.activeTask=null,this.init()}var c,u,d,p=!1,f=new s,h=new i;return l.prototype.init=function(){if(!p){if("undefined"==typeof window.jQuery)return void t.log("context:inter/init","error","Interactor could not initialise, jQuery not found!");c=window.jQuery,this.applyElements(),this.applyHandlers(),this.applyStyles(),this.applyContext(),this.applyHash(),p=!0}},l.prototype.isTask=function(e){return!e instanceof c&&(e=c(e)),e=e.closest("[id^=task_]"),e.length?e:!1},l.prototype.openTask=function(e){return t.log("context:interactor","Opening task #"+e+"..."),this.activeTask=e,"undefined"==typeof e?void this.expandTaskDetails():void this.findGlobalId(e,function(e){setTimeout(function(){e.trigger("click")},500)})},l.prototype.closeTask=function(){this.shrinkTaskDetails()},l.prototype.expandTaskDetails=function(){c(".panelDetail").is(":visible")&&(o.interactor.taskDetailsExpanded||(this.activeTask=this.findLocalIdFromDetails(),t.log("context:interactor","active task: #"+this.activeTask),c(".kbs-overlay").show(),c(".taskDetails").hide().addClass("kbs-details-expand"),setTimeout(function(){c(".taskDetails, .kbs-details-closed").fadeIn(),c(window).trigger("resize")},250),o.interactor.taskDetailsExpanded=!0))},l.prototype.shrinkTaskDetails=function(){var e=c(".taskDetails"),t=c(".kbs-details-closed");o.interactor.taskDetailsExpanded&&(this.activeTask=null,o.interactor.taskDetailsExpanded=!1,e.removeClass("kbs-details-expand"),t.fadeOut(),d.hideOverlay())},l.prototype.searchForTask=function(e,n){{var o,i=c(".VS-search-inner input"),s=c.Event("keydown");c("div.VS-icon:nth-child(4)")}t.log("context:interactor","Searching for task #"+e),s.keyCode=40,i.focus().trigger(s).trigger(s).trigger(s),s.keyCode=13,i.focus().trigger(s),o=c(".search_facet_input"),o.val(e).trigger("keydown"),setTimeout(function(){o.trigger(s),setTimeout(function(){n(c(".task")),document.activeElement.blur(),setTimeout(function(){c("div.VS-icon:nth-child(4)").trigger("click"),document.activeElement.blur()},1e3)},500)})},l.prototype.findGlobalId=function(e,n){var o,i,s,r,l,d=c(".task-id, .taskID"),p=function(){c(this)[0].textContent===e.toString()&&(o=c(this))};return"undefined"==typeof e&&(e=c(".local_task_id")[0].textContent),d.each(p),"undefined"==typeof o?"undefined"==typeof n?void t.log("context:interactor","error","Couldn't find global id for task #"+e+". Provide a callback function to allow async task searches!"):void this.searchForTask(e,function(o){u.findLocalIdFromTask(o)===e?n(o):(l="Couldn't find task #"+e,t.log("context:interactor","error",l),r=new a("task-not-found",{init:!0,id:e,confirm:function(){r.close(),r.getController().getModalByName("task-search").open()},cancel:function(){r.close()}}))}):(i=o.closest(".task"),s=i[0].id.replace("task_",""),n&&n(i),s)},l.prototype.findLocalId=function(e){return c("#task_"+e).find(".task-id, .taskID").text()},l.prototype.findGlobalIdFromTask=function(e){var t=e.closest(".task"),n=t[0].id.replace("task_","");return n},l.prototype.findLocalIdFromTask=function(e){var t=(e.closest(".task"),e.find(".task-id, .taskID").text());return t},l.prototype.findLocalIdFromDetails=function(){var e=c(".taskDetails"),t=e.find(".local_task_id");return t.text()||t.val()},l.prototype.findTaskFromComponent=function(e){var t=e.closest("[id^=task_]");return t.length?this.findLocalIdFromTask(t):!1},l.prototype.navigateTo=function(e){var n=c("#nav-"+e.toLowerCase());n.length?n.trigger("click"):t.log("context:interactor","error","Failed to navigate to: '"+e+"'")},l.prototype.viewScreenshot=function(e){var n,o,i=(h.get("bugherd"),{});o=parseInt(u.findLocalIdFromDetails(),10),t.log("context:interactor","debug","Viewing screenshot for task #"+o),n=new a("view-screenshot",{viewParams:{id:o,title:-1!==e[0].textContent.indexOf("screenshot")?"Screenshot":"Fix Result",url:e[0].href,width:i.x,height:i.y}})},l.prototype.onTasksWithTag=function(e,t){var n,o=h.get("bugherd"),i=(o.getTasks(),o.tasks.findAllWithTag(t)),s=i.length,r=0,l=0,c="show"===e?"block":"none";if("list"===e){for(l;s>l;l+=1)i[l]=i[l].attributes.local_task_id;return new a("view-object",{viewParams:{message:"Filter Results:",object:i}})}for(r;s>r;r+=1)n=document.getElementById("task_"+i[r].id),n&&(n.style.display=c)},l.prototype.onTasksWithClientData=function(e,t,n){var o=h.get("bugherd"),i=o.tasks.findAllWithClientData(t,n),s=i.length,r=0,l=0,c="show"===e?"block":"none";if("list"===e){for(l;s>l;l+=1)i[l]=i[l].attributes.local_task_id;return new a("view-object",{viewParams:{message:"Filter Results:",object:i}})}for(r;s>r;r+=1)document.getElementById("task_"+i[r].id).style.display=c},l.prototype.onTasksWithMetaData=function(e,t,n){var o,i=h.get("bugherd"),s=i.tasks.findAllWithMeta(t,n),r=s.length,l=0,c=0,u="show"===e?"block":"none";if("list"===e){for(c;c<s.length;c+=1)s[c]=s[c].attributes.local_task_id;return new a("view-object",{viewParams:{message:"Filter Results:",object:s}})}for(l;r>l;l+=1)o=document.getElementById("task_"+s[l].id),o&&(o.style.display=u)},l.prototype.hideAllTasks=function(){var e,t=h.get("bugherd"),n=t.getTasks(),o=n.length,i=0;for(i;o>i;i+=1)e=document.getElementById("task_"+n[i].id),e&&(e.style.display="none")},l.prototype.showAllTasks=function(){var e,t=h.get("bugherd"),n=t.getTasks(),o=n.length,i=0;for(i;o>i;i+=1)e=document.getElementById("task_"+n[i].id),e&&(e.style.display="block")},l.prototype.resetAllFilters=function(){this.showAllTasks(),c("div.head-actions:nth-child(1) > ul:nth-child(1) > li:nth-child(1) > ul:nth-child(3) > li:nth-child(1) > a:nth-child(1)").trigger("click"),this.showAllTasks()},l.prototype.getHash=function(){return window.location.hash},l.prototype.parseHash=function(){var e,n=this.getHash(),o=window.location.href;t.log("context:hash","parsing new hash: "+n),"#open"===n&&(e=-1!==o.indexOf("tasks/")?parseInt(o.split("tasks/")[1],10):parseInt(n.replace("#open",""),10)),"#settings"===n&&(f.launchModal(),location.hash=""),e&&this.openTask(e)},l.prototype.applyElements=function(){var e,n,o,i,s,l;t.log("context:inter/init","+ appending elements to bugherd"),e=new r("li"),e.createChild("a").text("Search Task").on("click",function(){i=new a("task-search",{proceed:function(e){e&&(i.close(),u.openTask(e))}})}),n=new r("li"),n.createChild("a").text("Filter").on("click",function(){s=new a("task-filter")}),o=new r("div","kbs-details-closed"),o.createChild("i","fa fa-times"),o.on("click",function(){u.closeTask()}),l=c(".nav.main-nav")[0],e.writeTo(l),n.writeTo(l),o.writeTo(c("body")[0])},l.prototype.applyHandlers=function(){var n,o,i,s=new r(".app-wrap"),a=new r(document.body),l=new r("#kanbanBoard");t.log("context:inter/init","+ applying handlers to bugherd"),s.on("click",function(t){var n=c(t.target),o=u.isTask(n);return o&&e.interactor.expandOnclick?void u.expandTaskDetails():void(n.hasClass("attachLink")&&n.text().match(/(fix-result)|(view_screenshot)|(\.png)|(\.jpg)/)&&(t.preventDefault(),u.viewScreenshot(n)))}),e.gui.wallpaper&&e.gui.parallax.enabled&&(n=!1,o=setInterval(function(){n=n?!1:!0},32),a.on("mousemove",function(t){if(i=e.gui.parallax.factor,n){var o=-(t.pageX/i),s=-(t.pageY/i);l.css("background-position",o+"px "+s+"px")}}))},l.prototype.applyStyles=function(){t.log("context:inter/init","+ applying styles to bugherd"),c(".pane-center .pane-content").css("background-image",e.gui.wallpaper),c(".nav.user-menu").css("margin-right","10px"),-1!==d.getThemeName().indexOf("DOS")&&(c(".VS-icon-search").append('<i class="fa fa-search"></i>'),c(".VS-icon-search").css("top","8px"),c(".VS-icon-cancel").append('<i class="fa fa-times"></i>'),c(".VS-icon-cancel").css("top","8px"))},l.prototype.applyContext=function(){t.log("context:inter/init","+ applying interactor context"),t.log("context:interactor","buffer","log-buffer: INTERACTOR")},l.prototype.applyHash=function(){t.log("context:inter/init","+ applying hash parser");window.location.href;t.log("context:hash","buffer","log-buffer: HASH"),this.getHash()&&setTimeout(function(){u.parseHash()},500),c(window).on("hashchange",function(){t.log("context:hash","hash changed: "+u.getHash()),u.parseHash()}),this.getHash()&&t.log("context:hash","found hash: "+this.getHash())},l}),define("test/main.test",["require","main/components/util"],function(e,t){function n(){this.modules=["components/util","components/events"]}return n.prototype.exec=function(n){t.log("context:test/"+n,"exec",'executing test: "'+n+'"...'),e([window.KBS_BASE_URL+"src/test/"+n+".test.js"])},n.prototype.execAll=function(){var e=this.modules.length,t=0;for(t;e>t;t+=1)this.exec(this.modules[t])},new n}),define("main/init",["config","main/components/util","main/components/events","main/components/status","main/components/cache","main/components/exception","main/components/repository","main/components/http","main/components/configurator","main/components/bugherd","main/ui/node","main/ui/gui","main/ui/modal","main/ui/interactor","test/main.test"],function(e,t,n,o,i,s,r,a,l,c,u,d,p,f,h){var m,g,y,v,b,k,w,x=new r;g=function(){window.KBS_DELTA_TIME=(new Date).getTime()-window.KBS_START_TIME+"ms",t.log("okay","Kanban initialised in "+window.KBS_DELTA_TIME+". Approx. size: "+t.bytesFormat(t.sizeof(m))),"dev"===e.mode&&(window[e.appName]=m,window[e.appName+"_REPO"]=x),"undefined"==typeof window.log&&(window.log=t.log),n.publish("kbs/status",{component:"app",status:!0}),e.test&&h.execAll()},n.subscribe("kbs/loaded",g),n.subscribe("kbs/status",function(e){o[e.component]=e.status});try{k=new l,k.loadExisting(),x.add("settings",k)}catch(C){b=new s(C,"Configurator failed to initialise cleanly.")}if(e.enabled){try{e.gui.enabled&&(y=new d,x.add("gui",y))}catch(T){b=new s(T,"GUI failed to initialise cleanly.")}try{e.interactor.enabled&&(v=new f,x.add("interactor",v))}catch(S){b=new s(S,"Interactor failed to initialise cleanly.")}try{w=new c,x.add("bugherd",w)}catch(N){b=new s(N,"BugHerd API failed to initialise cleanly.")}m={version:e.version,interactor:v,status:o,cache:i,config:e,events:n,util:t,gui:y,configurator:k,Constructor:{Configurator:l,Interactor:f,GUI:d,BugHerd:c,Http:a,Node:u,Modal:p,Exception:s}}}}),function(e){var t=e.require,n=document.getElementById("kbs-deposit").classList;e.KBS_GLOBAL_SET="true"===n[0]?!0:!1,e.KBS_START_TIME=n[1],e.KBS_DELTA_TIME="",e.KBS_BASE_URL=n[2],t.config({paths:{main:e.KBS_BASE_URL+"src/main",test:e.KBS_BASE_URL+"src/test"}}),e.onload=function(){e.KBS_START_TIME=(new Date).getTime(),t(["main/init"])}}(window),define("kanban",function(){})}();