/*
*   @type javascript
*   @name config.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name events.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name status.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name buffer.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name cache.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name cookies.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name util.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name node.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name counter.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name http.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name viewloader.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name modal.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name interactor.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name configurator.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name router.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name console.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name gui.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*    @type javascript test
*    @name main.test.js
*    @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name init.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name kanban.js
*   @copy Copyright 2015 Harry Phillips
*/

!function(){define("config",[],function(){function e(e){n=this,this.defaultObj=t(e),this.defaultObj.reset=this.reset,e.reset=this.reset,this.obj=e,o=this.obj}function t(e){var n,o,i,s;if(e instanceof Date)return n=new Date,n.setTime(e.getTime()),n;if(e instanceof Array){for(n=[],i=e.length,s=0;i>s;s+=1)n[s]=t(e[s]);return n}if(e instanceof Object){n={};for(o in e)e.hasOwnProperty(o)&&(n[o]=t(e[o]));return n}return"string"==typeof e||"number"==typeof e||"boolean"==typeof e?n=e:void 0}var n,o;return e.prototype.reset=function(){var e;for(e in n.obj)n.obj.hasOwnProperty(e)&&(n.defaultObj[e]||delete n.obj[e],n.obj[e]=n.defaultObj[e])},o=o||new e({appName:"kbs",appFullname:"Kanban",version:"1.3.0",enabled:!0,mode:"dev",httpToken:"Fw43Iueh87aw7",theme:"default",logs:{enabled:!0,gui:!0,contexts:!0,contextFlag:"context:",obj2buffer:!1,filter:!1},gui:{enabled:!0,autorefresh:!0,console:{state:"kbs-closed",autoscroll:!0,icons:{save:"file-text",clear:"trash",toggle:"terminal",close:"times",destroy:"unlink",example:"plus-circle",benchmark:"tachometer",settings:"cogs",expand:"caret-square-o-right"}}},interactor:{enabled:!0},events:{silent:!1},cookies:{enabled:!0,prefix:"__kbs_"},routes:{console:{save:"endpoint/SaveBuffer.php"}},tooltips:{save:"Save the output buffer to text file",clear:"Clear all logs",toggle:"GUI Console State",close:"Close the console",destroy:"Destroy this console instance",benchmark:"Run the benchmark",settings:"Edit Kanban settings"}}).obj}),define("main/components/events",["config"],function(e){function t(){this.topics={}}return t.prototype.subscribe=function(e,t){this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t)},t.prototype.publish=function(t,n){if(this.topics[t]){var o;for(o=0;o<this.topics[t].length;o+=1)this.topics[t][o](n);"object"!=typeof n&&(n={data:n})}else if(!e.events.silent)throw new Error("Event '"+t+"' does not exist!")},new t}),define("main/components/status",{app:!1,interactor:{taskDetailsExpanded:!1},gui:!1,console:!1,modal:!1}),define("main/components/buffer",[],function(){function e(e){t.push(e||""),this.index=t.length-1}var t=[];return e.prototype.writeToBuffer=function(e){var n=this.index;return"string"==typeof t[n]?void(t[n]+=e):t[n]instanceof Array?void t[n].push(e):void 0},e.prototype.removeFromBuffer=function(e){var n,o=this.index;return"string"==typeof t[o]?void(t[o]=t[o].replace(e,"")):t[o]instanceof Array?(n=t[o].indexOf(e),void t[o].splice(n,1)):void 0},e.prototype.getBuffer=function(){return t[this.index]},e.prototype.getGlobalBuffer=function(){return t},e.prototype.clearBuffer=function(){var e=this.index;t[e]=null,t[e]=""},e}),define("main/components/cache",["main/components/buffer"],function(e){var t={app:new e,console:new e};return t}),define("main/components/cookies",["config"],function(e){function t(){}return t.prototype.get=function(t){var n,o,i=e.cookies.prefix+t+"=",s=document.cookie.split(";");for(o=0;o<s.length;o+=1){for(n=s[o];" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return""},t.prototype.set=function(t,n,o){var i,s;o?(s=new Date,s.setTime(s.getTime()+24*o*60*60*1e3),i="; expires="+s.toGMTString()):i="",document.cookie=e.cookies.prefix+t+"="+n+i+"; path=/"},t.prototype.del=function(e){this.set(e,"",-1)},t.prototype.exists=function(e){var t=this.get(e);return""!==t&&null!==t&&void 0!==t},t}),define("main/components/util",["config","main/components/events","main/components/status","main/components/cache","main/components/cookies","main/components/buffer"],function(e,t,n,o,i){function s(){}var r,a=new s;return s.prototype.zerofy=function(e,t){for(;e.toString().length<(t||2);)e="0"+e;return e},s.prototype.spacify=function(e,t){for("string"!=typeof e&&(e=e.toString());e.length<t;)e=" "+e;return e},s.prototype.ftime=function(){var e=new Date,t=a.zerofy(e.getHours()),n=a.zerofy(e.getMinutes()),o=a.zerofy(e.getSeconds()),i=a.zerofy(e.getMilliseconds(),3);return t+":"+n+":"+o+"."+i},s.prototype.fdate=function(){var e=new Date,t=a.zerofy(e.getFullYear(),4),n=a.zerofy(e.getMonth(),2),o=a.zerofy(e.getDate(),2);return t+"-"+n+"-"+o},s.prototype.escapeRegEx=function(e){var t;return t=String(e).replace(/([\-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},s.prototype.cookie=new i,s.prototype.isNode=function(e){return"Node"===e.constructor.name},s.prototype.isDomElement=function(e){return"object"==typeof window.HTMLElement?e instanceof window.HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},s.prototype.parseHTML=function(e){var t=document.createElement("div");return t.innerHTML=e,t},s.prototype.isDate=function(e){return"undefined"==typeof e?!1:e instanceof Date},s.prototype.isArray=function(e){return"undefined"==typeof e?!1:e instanceof Array||"Array"===e.constructor.name},s.prototype.isObject=function(e){return"undefined"==typeof e||a.isArray(e)?!1:e instanceof Object},s.prototype.isString=function(e){return"undefined"==typeof e?!1:"string"==typeof e},s.prototype.isNumber=function(e){return"undefined"==typeof e?!1:"number"==typeof e},s.prototype.isBoolean=function(e){return"undefined"==typeof e?!1:"boolean"==typeof e},s.prototype.contains=function(e,t,n){var o,i,s,r=0,c=[];if("undefined"==typeof e||""===e)throw new Error("Could not determine a contained value, haystack object is undefined!");if("undefined"==typeof t||""===t)return!1;if(i=function(e,t){if(!n)return-1!==e.indexOf(t);if(t=a.escapeRegEx(t),o=new RegExp("(\\W|^)"+t+"(\\W|$)"),a.isArray(e)){for(;r<e.length;)o.test(e[r])&&c.push(r),r+=1;return n?0===c.length?!1:c.length>1?c:c[0]:!0}return o.test(e)?!0:!1},n=n||!1,!a.isArray(t))return i(e,t);for(r=0;r<t.length;r+=1)if(s=i(e,t[r]),s!==!1)return s;return!1},s.prototype.swap=function(e,t,n){var o=e[t];e[t]=e[n],e[n]=o},s.prototype.clone=function(e){var t,n,o,i;if(a.isDate(e))return t=new Date,t.setTime(e.getTime()),t;if(a.isArray(e)){for(t=[],o=e.length,i=0;o>i;i+=1)t[i]=a.clone(e[i]);return t}if(a.isObject(e)){t={};for(n in e)e.hasOwnProperty(n)&&(t[n]=a.clone(e[n]));return t}return a.isString(e)||a.isNumber(e)||a.isBoolean(e)?t=e:void a.log("error","Couldn't clone object of unsupported type: "+typeof e)},s.prototype.merge=function(e,t,n){var o,i;for(o in t)t.hasOwnProperty(o)&&(i="undefined"!=typeof e[o],(!i||i&&n)&&(a.isObject(t[o])?a.merge(e[o],t[o],n):e[o]=t[o]));return e},s.prototype.serialise=function(e,t){var n,o,i,s,r,c=!1;if(t=t||!0,o=e,a.isObject(e))if(t)o=JSON.stringify(e);else{o="{",s=a.listProperties(e),c=!0;for(n in e)e.hasOwnProperty(n)&&(o+=n+":"+a.serialise(e[n],t),s.indexOf(n)===s.length-1&&(c=!1),c&&(o+=", "));o+="}"}if(a.isArray(e)){for(n=0,i=e.length,o="[",n;i>n;n+=1)c=n>0&&n!==i,c&&(o+=", "),r=e[n],o+=a.isString(r)?"'"+r+"'":a.isNumber(r)?r:a.serialise(r,t);o+="]"}return a.isString(e)?"'"+o+"'":o},s.prototype.unserialise=function(e,t){function n(e){var n,o,i,s,r,c=[],l=new RegExp(/(\[)|(\{)/g),u=new RegExp(/(\])|(\})/g),p=!1,d="",f=0,h=0;e=e.replace(/\s,*/g,""),e=e.replace(/,\s*/g,","),e=e.substring(1,e.length-1),i=e.length;do r=e.charAt(h-1),s=e.charAt(h),("'"===s||'"'===s)&&"\\"!==r&&s===n&&(p&&s===n?(p=!1,n=""):p||(p=!0,n=s)),l.test(s)&&!p&&(f+=1),u.test(s)&&!p&&(f-=1),o=(","===s||u.test(s))&&!f&&!p,o||h===i?(c.push(a.unserialise(d,t)),d=""):d+=s,h+=1;while(i>=h);return c}function o(e){var t={};return e=e.replace(/(:\s)/g,":"),e=e.replace(/(\s\{)/g,"{"),e=e.replace(/(\{\s)/g,"{"),e=e.replace(/(\s\})/g,"}"),e=e.replace(/(\}\s)/g,"}"),t}function i(e){var t=/(')|(")/g;return e=e.charAt(0).match(t)&&e.charAt(e.length-1).match(t)?e.substring(1,e.length-1):Number(e)}var s;return t=t||!0,s=e,a.isNumber(e)||a.isObject(e)||a.isArray(e)?e:"["===e.charAt(0)?n(e):"{"===e.charAt(0)?t?JSON.parse(e):o(e):a.isString(e)?i(e):s},s.prototype.listProperties=function(e){var t,n=[];if(a.isObject(e)){for(t in e)e.hasOwnProperty(t)&&n.push(t);return n}},s.prototype.log=function(i,s,r,c){function l(){c=r,r=s,s=i}if(e.logs.enabled){var u,p=0,d=[],f=e.logs.filter,h=[],m="",g=!1,y=!1,b="",v="",k="",w=e.logs.contextFlag,x=e.logs.contextClearFlag;for(u in arguments)arguments.hasOwnProperty(u)&&d.push(arguments[u]);if(e.logs.contexts?"string"==typeof i?-1!==i.indexOf(w)?a.log.currentContext!==!1?(y=i.replace(w,""),i=a.log.currentContext,d.shift()):(i=i.replace(w,""),d.shift()):-1!==i.indexOf(x)?d.shift():(l(),i=a.log.currentContext):(l(),i=a.log.currentContext):(-1!==i.indexOf(w)?d.shift():l(),i=!1,y=!1),d.length>2?"object"==typeof r&&(g=r,r=c):d.length>1?"object"==typeof s?(g=s,s="log"):"object"==typeof r&&(g=r,r=""):(r=s,s="log","object"==typeof r&&(g=r,r="")),!f||a.contains(f,s,!0)===!1)for(m+=a.ftime(),m+=" ["+(y||i||e.appName)+"]",m+=" ["+s+"]:> ",m+=r,h.push(m),g&&(v="Object "+JSON.stringify(g,null,4)),k=m.replace(/\s/g," "),k=encodeURIComponent(k),k+=e.logs.obj2buffer?""!==v?"\n"+v:"":""!==v?"\n[object omitted]":"",k+="\n",o.console.writeToBuffer(k),e.logs.gui&&n.console&&(b=m.replace(/\s/g," "),t.publish("gui/log",{msg:b,type:s,obj:v,context:i,subcontext:y})),window.console[s]||(s="log"),g&&h.push(g);p<h.length;)window.console[s](h[p]),p+=1}},s.prototype.log.currentContext=a.log.currentContext||!1,s.prototype.log.beginContext=function(t){return e.logs.contexts?-1!==t.indexOf(e.logs.contextFlag)?void a.log("error","You shouldn't pass the context flag when using beginContext()"):void(a.log.currentContext=t):void 0},s.prototype.log.endContext=function(){a.log.currentContext=!1},s.prototype.log.clearContext=function(e){t.publish("gui/contexts/clear",e)},r=new s,a.log("+ util.js loaded"),r}),define("main/components/node",["config","main/components/util"],function(e,t){function n(e,t,n){"undefined"!=typeof e.appendChild?this.element=e:(this.settings={type:e,classes:t,id:n},this.element=document.createElement(e),this.element.className=t||"",n&&(this.element.id=n))}return n.prototype.show=function(){this.element.style.display="block"},n.prototype.hide=function(){this.element.style.display="none"},n.prototype.fadeIn=function(e){"undefined"==typeof window.jQuery&&this.show(),window.jQuery(this.element).fadeIn(e)},n.prototype.fadeOut=function(e){return"undefined"==typeof window.jQuery?void this.hide():void window.jQuery(this.element).fadeOut(e)},n.prototype.getId=function(){return this.element.id},n.prototype.getClasses=function(){return this.element.className},n.prototype.hasClass=function(e){var n,o,i=!1;if(t.isArray(e))for(o=e.length,n=0;o>n;n+=1)-1!==this.element.className.indexOf(e[n])&&(i=!0);else-1!==this.element.className.indexOf(e)&&(i=!0);return i},n.prototype.addClass=function(e){""===this.element.className?this.element.className=e:this.element.className+=" "+e},n.prototype.removeClass=function(e){var n,o,i=this.element.className,s=function(e){n=-1!==i.indexOf(" "+e)?i.replace(" "+e,""):-1!==i.indexOf(e+" ")?i.replace(e+" ",""):i.replace(e,"")};if(t.isArray(e))for(n=i,o=0;o<e.length;o+=1)s(e[o]);else s(e);this.element.className=n},n.prototype.setClass=function(e){this.element.className=e},n.prototype.parent=function(){return this.element.parentNode},n.prototype.addChild=function(e){return e.constructor===n||e instanceof n?void this.element.appendChild(e.element):void this.element.appendChild(e)},n.prototype.createChild=function(e,t,o){var i=new n(e,t,o);return this.addChild(i.element),i},n.prototype.detach=function(){this.element.parentNode.removeChild(this.element)},n.prototype.attach=function(){this.element.parentNode.appendChild(this.element)},n.prototype.destroy=function(){this.parent().removeChild(this.element),this.element=null},n.prototype.clone=function(){var e=new n(this.settings.type,this.getClasses(),this.getId());return e.element=null,e.element=this.element.cloneNode(),e},n.prototype.focus=function(){return this.element.focus(),this},n.prototype.attr=function(e,t){return"undefined"==typeof t?this.element.getAttribute(e):(this.element.setAttribute(e,t),this)},n.prototype.text=function(e){return"undefined"==typeof e?this.element.textContent||this.element.value:(e=document.createTextNode(e),this.addChild(e),this)},n.prototype.val=function(e){return"undefined"==typeof e?this.element.value:(this.element.value=e,this)},n.prototype.on=function(e,t){return this.element.addEventListener(e,t),this},n.prototype.writeTo=function(e){"undefined"!=typeof e&&e.appendChild(this.element)},n}),define("main/components/counter",[],function(){function e(e,t){var n=0,o=!1;this.target=e,this.exec=t,Object.defineProperty(this,"count",{get:function(){return n},set:function(t){n=t,n>=e&&!o&&(o=!0,this.exec())}})}return e}),define("main/components/http",["config","main/components/util","main/components/counter"],function(e,t){function n(e){this.url=e.url,this.method=e.method||"GET",this.async=e.async||!0,this.data=e.data,this.callbacks={},this.callbacks.success=e.success||function(){},this.callbacks.fail=e.fail||function(){},o=this,e.send&&this.send(this.data)}var o,i=e.httpToken;return n.prototype.encodeData=function(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&(n+=t+"="+e[t]+"&");return i&&(n+="kbstoken="+i),n},n.prototype.send=function(){var e=new XMLHttpRequest;e.open(this.method,this.url,this.async),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4===this.readyState&&(200===this.status&&this.status<400?(t.log("debug","HTTP 200: "+o.url),o.callbacks.success(this.responseText)):(t.log("debug","HTTP "+this.status+": "+o.url),o.callbacks.fail(this.responseText)))},e.send(o.encodeData(o.data)),e=null},n}),define("main/components/viewloader",["require"],function(e){function t(){}return t.prototype.load=function(t,n){e(["main/views/"+t],function(e){n(e)})},t}),define("main/ui/modal",["config","main/components/util","main/components/events","main/components/status","main/components/http","main/components/node","main/components/viewloader"],function(e,t,n,o,i,s,r){function a(e,n){l=this,t.contains(p,e)||(p.push(e),this.viewName=e,this.params=n,this.node=new s("div","kbs-modal kbs-"+e),this.node.hide(),this.view=null,this.applyHandlers(n),this.load(n.init?this.init:function(){}))}var c,l,u=new r,p=[];return a.prototype.load=function(e){l=this;var t;u.load("modals/"+this.viewName,function(n){t=n.createView([c,l]),l.view=t,l.title=t.title,e()})},a.prototype.init=function(){var e=l.node,t=e.createChild("h2","kbs-modal-title"),n=e.createChild("i","fa fa-times kbs-modal-closed"),o=e.createChild("p","kbs-modal-content");t.text(l.title),n.on("click",l.destroy),o.addChild(l.view),c.addChild(e),l.open()},a.prototype.applyHandlers=function(e){l=this;var n=function(e){t.log("warn","Modal '"+l.viewName+"' event '"+e+"' ran but didn't have a handler!"),l.destroy()};this.onConfirm=e.confirm||function(){n("confirm")},this.onCancel=e.cancel||function(){n("cancel")},this.onProceed=e.proceed||function(){n("proceed")}},a.prototype.open=function(){o.modal||(o.modal=!0,c.tree.main.overlay.fadeIn(),l.node.fadeIn())},a.prototype.close=function(){o.modal=!1,c.tree.main.overlay.hide(),l.node.hide()},a.prototype.destroy=function(){o.modal=!1,c.tree.main.overlay.hide(),l.node.destroy(),p.splice(p.indexOf(l.viewName),1)},a.prototype.setInstance=function(e){c=e},a}),define("main/ui/interactor",["config","main/components/util","main/components/events","main/components/status","main/components/node","main/ui/modal"],function(e,t,n,o,i,s){function r(){t.log("context:inter/init","info","Initialising Interactor..."),c=this,this.init()}var a,c,l=!1;return r.prototype.init=function(){if(!l){if("undefined"==typeof window.jQuery)return void t.log("context:inter/init","error","Interactor could not initialise, jQuery not found!");a=window.jQuery,this.applyElements(),this.applyHandlers(),this.applyStyles(),this.applyContext(),this.applyHash(),l=!0}},r.prototype.isTask=function(e){return!e instanceof a&&(e=a(e)),e=e.closest("[id^=task_]"),e.length?e:!1},r.prototype.getTaskFromComponent=function(e){return e.closest("[id^=task_]")},r.prototype.openTask=function(e){return t.log("context:interactor","Opening task #"+e+"..."),"undefined"==typeof e?void this.expandTaskDetails():void this.findGlobalId(e,function(e){e.trigger("click")})},r.prototype.closeTask=function(){this.shrinkTaskDetails()},r.prototype.expandTaskDetails=function(){a(".panelDetail").is(":visible")&&(o.interactor.taskDetailsExpanded||(a(".kbs-overlay").show(),a(".taskDetails").hide().addClass("kbs-details-expand"),setTimeout(function(){a(".taskDetails, .kbs-details-closed").fadeIn(),a(window).trigger("resize")},250),o.interactor.taskDetailsExpanded=!0))},r.prototype.shrinkTaskDetails=function(){var e=a(".taskDetails"),t=a(".kbs-overlay"),n=a(".kbs-details-closed");o.interactor.taskDetailsExpanded&&(e.removeClass("kbs-details-expand"),n.fadeOut(),t.fadeOut(),o.interactor.taskDetailsExpanded=!1)},r.prototype.searchForTask=function(e,n){{var o,i=a(".VS-search-inner input"),s=a.Event("keydown");a("div.VS-icon:nth-child(4)")}t.log("context:interactor","Searching for task #"+e),s.keyCode=40,i.focus().trigger(s).trigger(s).trigger(s),s.keyCode=13,i.focus().trigger(s),o=a(".search_facet_input"),o.val(e).trigger("keydown"),setTimeout(function(){o.trigger(s),setTimeout(function(){n(a(".task")),document.activeElement.blur(),setTimeout(function(){a("div.VS-icon:nth-child(4)").trigger("click")},1e3)},500)})},r.prototype.findGlobalId=function(e,n){var o,i,r,l,u,p=a(".task-id, .taskID"),d=function(){a(this)[0].textContent===e.toString()&&(o=a(this))};return"undefined"==typeof e&&(e=a(".local_task_id")[0].textContent),p.each(d),"undefined"==typeof o?"undefined"==typeof n?void t.log("context:interactor","error","Couldn't find global id for task #"+e+". Provide a callback function to allow async task searches!"):void this.searchForTask(e,function(o){c.findLocalIdFromTask(o)===e?n(o):(u="Couldn't find task #"+e,t.log("context:interactor","error",u),l=new s("small",{init:!0,title:"Task search failed!",message:u}))}):(i=o.closest(".task"),r=i[0].id.replace("task_",""),n&&n(i),r)},r.prototype.findLocalId=function(e){a("#task_"+e).find(".task-id, .taskID").text()},r.prototype.findGlobalIdFromTask=function(e){var t=e.closest(".task"),n=t[0].id.replace("task_","");return n},r.prototype.findLocalIdFromTask=function(e){var t=(e.closest(".task"),e.find(".task-id, .taskID").text());return t},r.prototype.getHash=function(){return window.location.hash},r.prototype.parseHash=function(){var e,n=this.getHash(),o=window.location.href;t.log("context:hash","parsing new hash: "+n),"#open"===n&&-1!==o.indexOf("tasks/")&&(e=parseInt(o.split("tasks/")[1],10),e&&this.openTask(e)),e=parseInt(n.replace("#open",""),10),e&&this.openTask(e)},r.prototype.applyElements=function(){var e,n,o;t.log("context:inter/init","+ appending elements to bugherd"),e=new i("li"),e.createChild("a").text("Search Task").on("click",function(){o=new s("searchTask",{init:!0,proceed:function(e){e&&(o.destroy(),c.openTask(e))}})}),n=new i("div","kbs-details-closed"),n.createChild("i","fa fa-times"),n.on("click",function(){c.closeTask()}),e.writeTo(a(".nav.main-nav")[0]),n.writeTo(a("body")[0])},r.prototype.applyHandlers=function(){t.log("context:inter/init","+ applying handlers to bugherd"),a(".app-wrap").on("click",function(e){var t=a(e.target),n=c.isTask(t);n&&c.expandTaskDetails()})},r.prototype.applyStyles=function(){t.log("context:inter/init","+ applying styles to bugherd"),a(".nav.user-menu").css("margin-right","10px")},r.prototype.applyContext=function(){t.log("context:inter/init","+ applying interactor context"),t.log("context:interactor","info","Interactor log output...")},r.prototype.applyHash=function(){t.log("context:inter/init","+ applying hash parser");window.location.href;t.log("context:hash","info","Hash events..."),this.getHash()&&setTimeout(function(){c.parseHash()},500),a(window).on("hashchange",function(){t.log("context:hash","hash changed: "+c.getHash()),c.parseHash()}),this.getHash()&&t.log("context:hash","found hash: "+this.getHash())},r}),define("main/components/configurator",["config","main/components/util","main/ui/modal"],function(e,t,n){function o(){i=this,this.modal=null}var i,s={};return o.prototype.getUserData=function(){var e=t.cookie.get("settings"),n=t.unserialise(e);return n||{}},o.prototype.loadExisting=function(){var n=this.getUserData();return n?(t.log("loading existing user config"),s=n,void t.merge(e,n,!0)):void 0},o.prototype.modifiedProperties=function(){var e,t=[];for(e in s)s.hasOwnProperty(e)&&t.push(e);return t},o.prototype.launchModal=function(){i.modal=new n("userConfig",{init:!0})},o.prototype.get=function(t){var n=0,o=t.split("/"),i=e,s=o.length;for(n;s>n;n+=1)i=i[o[n]];return i},o.prototype.set=function(n,o){var i,r,a=n.split("/"),c=a.length,l=e,u=0,p=s;if(1===c)return e[n]=o,s[n]=o,t.cookie.set("settings",t.serialise(s)),e[n];for(u;c>u;u+=1)u===c-2&&(i=l[a[u]],r=a[u]),l=l[a[u]],u!==c-1?(p[a[u]]={},p=p[a[u]]):p[a[u]]=o;return i[a[c-1]]=o,t.cookie.set("settings",t.serialise(s)),i[a[c-1]]},o.prototype.reset=function(){e.reset(),t.cookie.del("settings"),location.reload()},o}),define("main/components/router",["config"],function(e){return{getRoute:function(t,n){return window.KBS_BASE_URL+e.routes[t][n]}}}),define("main/ui/console",["config","main/components/util","main/components/events","main/components/http","main/components/status","main/components/router","main/components/cache","main/components/node","main/components/configurator","main/ui/modal"],function(e,t,n,o,i,s,r,a,c,l){function u(t){if(e.logs.gui){if(p=this,"undefined"==typeof t)throw new Error("No GUI instance passed to Console");d=t,this.buildNodeTree(),this.setContexts(),n.subscribe("gui/contexts/clear",function(e){p.clearContext(e)}),n.publish("kbs/status",{component:"console",status:!0})}}var p,d,f;return u.prototype.setContexts=function(){this.contexts||(this.contexts={def:p.wrapper.cons.out.element})},u.prototype.getContext=function(t){return e.logs.contexts?this.contexts[t]:this.contexts.def},u.prototype.createContext=function(n,o){if(e.logs.contexts){var i;return this.contexts[n]&&t.log("error","Log context: '"+n+"' is already defined"),t.isNode(o)?i=o.createChild("div","kbs-log-context",n):(i=new a("div","kbs-log-context","kbs-ctx-"+n),o.appendChild(i.element)),this.contexts[n]=i.element,o}},u.prototype.clearContext=function(e){"def"!==e&&delete p.contexts[e]},u.prototype.write=function(e){var n,o,i=p.getContext("def"),s=new a("div","kbs-log-node kbs-"+e.type),r=document.createTextNode(e.msg),c=new a("pre","kbs-object"),l=new a("i","fa fa-"+p.getIcon("expand")+" kbs-object-expand"),u=!1;e.context&&(e.subcontext?p.getContext(e.subcontext)?i=p.getContext(e.subcontext):(i=p.getContext(e.context),u=e.subcontext):p.getContext(e.context)?i=p.getContext(e.context):u=e.context),s.addChild(r),e.obj&&(o=document.createTextNode(e.obj),l.element.onclick=function(e){var n=e.target,o=n.parentNode;t.contains(o.className,"kbs-expand")?(o.className=o.className.replace(" kbs-expand",""),n.className=n.className.replace(" kbs-rotate","")):(o.className+=" kbs-expand",n.className+=" kbs-rotate")},c.addChild(l.element),c.addChild(o),s.addChild(c.element)),i.parentNode&&(n=i.parentNode.className,e.type.match(/(test)|(buffer)/)&&t.contains(n,"kbs-exec")&&s.addClass("kbs-log-closed")),i.appendChild(s.element),u&&p.createContext(u,s.element),p.refresh()},u.prototype.createTool=function(t){var n,o=this.wrapper.constools;if("undefined"==typeof o)throw new Error("Could not create new tool, no toolbar!");return n=this.getIcon(t),o[t]=o.createChild("i","fa fa-"+n+" kbs-tool kbs-"+t),o[t].element.title=e.tooltips[t]||"",o[t]},u.prototype.getIcon=function(t){return e.gui.console.icons[t]||"plus"},u.prototype.open=function(){p.wrapper.removeClass("kbs-closed"),p.wrapper.addClass("kbs-open")},u.prototype.close=function(){p.wrapper.removeClass("kbs-open"),p.wrapper.addClass("kbs-closed")},u.prototype.refresh=function(){var e=p.wrapper.cons.element;e.scrollTop=e.scrollHeight},u.prototype.clear=function(){var e,n=p.wrapper.cons.element,o=p.wrapper.cons.out.element,i=(new Date).getTime(),s=0;for(n.removeChild(o);o.firstChild;)s+=1,o.removeChild(o.firstChild);n.appendChild(o),e=(new Date).getTime()-i,t.log("okay","cleared "+s+" logs in "+e+" ms"),r.console.clearBuffer()},u.prototype.save=function(){var e,n=(t.ftime(),t.fdate()),i=r.console.getBuffer();t.log.beginContext("log/save"),t.log("info","saving log buffer..."),e=new o({url:s.getRoute("console","save"),method:"POST",send:!0,data:{type:"log",date:n,buffer:i},success:function(e){t.log("context:log/save","okay",e),t.log.endContext(),t.log.clearContext("log/save")}})},u.prototype.destroy=function(){var e=new l("destructConsole",{init:!0,confirm:function(){var t=p.wrapper.parent(),n=p.wrapper.element;t.removeChild(n),i.console=!1,r.console.clearBuffer(),e.destroy()},cancel:function(){e.destroy()}})},u.prototype.buildNodeTree=function(){var t,n,o,i,s,r,a,l=-1!==window.KBS_BASE_URL.indexOf("localhost")?"local":"remote";return n="kbs-cons-box "+e.gui.console.state,this.wrapper=t=d.createChild("div",n),e.logs.enabled||t.addClass("kbs-disabled"),o=t.constools=t.createChild("div","kbs-cons-toolbar"),i=o.constitle=o.createChild("div","kbs-cons-title"),s=document.createTextNode(e.appFullname+" v"+e.version+" - "+l),i.addChild(s),this.createTool("toggle").element.onclick=function(){var e=t.hasClass("kbs-closed"),n=t.hasClass("kbs-full");e||n||t.addClass("kbs-full"),n&&t.removeClass("kbs-full"),e&&p.open()},f=new c,this.createTool("settings").element.onclick=f.launchModal,-1!==window.KBS_BASE_URL.indexOf("localhost")&&(this.createTool("save").element.onclick=p.save),this.createTool("benchmark").element.onclick=p.benchmark,this.createTool("destroy").element.onclick=p.destroy,this.createTool("clear").element.onclick=p.clear,this.createTool("close").element.onclick=p.close,t.cons=r=t.createChild("div","kbs-cons"),e.logs.enabled||r.hide(),a=r.out=r.createChild("div","kbs-cons-out"),t},u.prototype.benchmark=function(){var e,n,o,i=p.wrapper.cons.element,s=p.wrapper.cons.out.element,r=1e4,a=(new Date).getTime(),c=0;for(t.log("context:benchmark","exec","executing benchmark..."),t.log.beginContext("benchmark"),i.removeChild(s),t.log("context:benchmark/output","buffer","benchmark output...");r>=c;)t.log("context:benchmark/output","debug","log #"+c),c+=1;i.appendChild(s),e=(new Date).getTime()-a,n=Math.floor(r/e*1e3),o="Logged "+r+" messages in "+e+"ms",t.log("context:benchmark","okay",o),t.log("okay",n+" logs per second."),t.log.endContext(),p.clearContext("benchmark")},u}),define("main/ui/gui",["config","main/components/util","main/components/events","main/components/counter","main/components/configurator","main/components/node","main/ui/console","main/ui/modal"],function(e,t,n,o,i,s,r,a){function c(){l=this,a.prototype.setInstance(this),this.tree=this.buildNodeTree(),this.console=new r(this),this.init(),n.publish("kbs/status",{component:"gui",status:!0})}var l,u=new i;return t.log("+ gui.js loaded"),c.prototype.init=function(){var i=new o(e.offline?2:3,function(){n.publish("gui/loaded")}),s=document.createElement("link"),r=document.createElement("link"),a=document.createElement("link"),c=window.KBS_BASE_URL+"css/main.css",u=window.KBS_BASE_URL+"css/themes/"+(e.theme||"default")+".css",p="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css",d=function(){document.body.appendChild(l.tree.main.element),t.log("context:gui/init","+ attached gui tree"),l.runEventListeners(),n.publish("kbs/loaded")};e.gui.enabled&&(e.logs.gui&&n.subscribe("gui/log",this.console.write),n.subscribe("gui/loaded",d)),s.rel="stylesheet",r.rel="stylesheet",a.rel="stylesheet",s.href=c,r.href=u,a.href=p,r.id="kbs-theme-link",t.log("context:gui/init","info","Initialising GUI..."),s.onload=function(){t.log("context:gui/init","+ main.css loaded"),i.count+=1},s.onerror=function(){throw i.count+=1,new Error("main.css failed to load!")},r.onload=function(){var e=l.getThemeName();t.log("context:gui/init","+ theme '"+e+"' loaded"),i.count+=1},r.onerror=function(){i.count+=1,t.log("error","theme '"+l.getThemeName()+"' failed to load!")},a.onload=function(){t.log("context:gui/init","+ font-awesome.css loaded"),i.count+=1},a.onerror=function(){throw i.count+=1,new Error("font-awesome.css failed to load!")},e.offline||document.head.appendChild(a),document.head.appendChild(s),document.head.appendChild(r)},c.prototype.getThemeName=function(e){var t=document.getElementById("kbs-theme-link"),n=e||t.href;return n=n.replace(window.KBS_BASE_URL+"css/themes/",""),n=n.replace(".css","")},c.prototype.resetTheme=function(){l.loadTheme(e.theme||"theme")},c.prototype.loadTheme=function(e){var t=document.getElementById("kbs-theme-link"),n=new s(t);e=e.replace(".css",""),n.attr("href",window.KBS_BASE_URL+"css/themes/"+e+".css"),u.set("theme",e)},c.prototype.unloadTheme=function(){var e=document.getElementById("kbs-theme-link"),t=new s(e);t.attr("href","")},c.prototype.buildNodeTree=function(){var e,t={};return t.main=e=new s("div","kbs-gui"),e.overlay=e.createChild("div","kbs-overlay"),t},c.prototype.runEventListeners=function(){t.log("context:gui/init","+ running event listeners");var n,o,i=this.console.wrapper.cons.out.element;o=e.logs.contexts?["kbs-exec","kbs-test","kbs-buffer"]:"",i.onclick=function(e){n=new s(e.target),n.hasClass(o)&&(n.hasClass("kbs-log-closed")?n.removeClass("kbs-log-closed"):n.addClass("kbs-log-closed"))}},c.prototype.addChild=function(e){this.tree.main.addChild(e)},c.prototype.createChild=function(e,t,n){var o=new s(e,t,n);return this.addChild(o),o},c.prototype.getCurrentInstance=function(){return l},c}),define("test/main.test",["require","main/components/util"],function(e,t){function n(){this.modules=["components/util","components/events"]}return n.prototype.exec=function(n){t.log("context:test/"+n,"exec",'executing test: "'+n+'"...'),e([window.KBS_BASE_URL+"test/"+n+".test.js"])},n.prototype.execAll=function(){var e=this.modules.length,t=0;for(t;e>t;t+=1)this.exec(this.modules[t])},new n}),define("main/init",["config","main/components/util","main/ui/interactor","main/components/events","main/components/status","main/components/cache","main/components/http","main/components/configurator","main/ui/gui","test/main.test"],function(e,t,n,o,i,s,r,a,c,l){var u,p,d,f,h;h=new a,h.loadExisting(),e.enabled&&(o.subscribe("kbs/status",function(e){i[e.component]=e.status}),e.gui.enabled&&(d=new c),e.interactor.enabled&&(f=new n),p=function(){window.KBS_DELTA_TIME=(new Date).getTime()-window.KBS_START_TIME+"ms",t.log("okay",u,"Kanban initialised in "+window.KBS_DELTA_TIME),"dev"===e.mode&&(window[e.appName]=u),"undefined"==typeof window.log&&(window.log=t.log),o.publish("kbs/status",{component:"app",status:!0}),e.test&&l.execAll()},u={version:e.version,interactor:f,status:i,cache:s,config:e,events:o,http:r,util:t,gui:d,configurator:h},o.subscribe("kbs/loaded",p))}),function(e){var t=e.require,n=document.getElementById("kbs-deposit").classList;e.KBS_GLOBAL_SET="true"===n[0]?!0:!1,e.KBS_START_TIME=n[1],e.KBS_DELTA_TIME="",e.KBS_BASE_URL=n[2],t.config({paths:{main:e.KBS_BASE_URL+"src/main",test:e.KBS_BASE_URL+"src/test"}}),e.onload=function(){e.KBS_START_TIME=(new Date).getTime(),t(["main/init"])}}(window),define("kanban",function(){})}();