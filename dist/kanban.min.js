/*
*   @type javascript
*   @name config.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name events.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name status.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name buffer.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name cache.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name cookies.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name util.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name exception.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name repository.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name counter.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name http.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name viewloader.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name node.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name modal.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name configurator.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name bugherd.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name router.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name console.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name gui.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name interactor.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*    @type javascript test
*    @name main.test.js
*    @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name init.js
*   @copy Copyright 2015 Harry Phillips
*/

/*
*   @type javascript
*   @name kanban.js
*   @copy Copyright 2015 Harry Phillips
*/

!function(){define("config",{appName:"kbs",appFullname:"Kanban",version:"1.5.1",enabled:!0,mode:"dev",httpToken:"Fw43Iueh87aw7",theme:"default",test:!1,logs:{enabled:!0,gui:!0,contexts:!0,contextFlag:"context:",obj2buffer:!1,filter:!1},gui:{enabled:!0,autorefresh:!0,wallpaper:"",severityStyles:!0,parallax:{enabled:!1,factor:100},console:{state:"kbs-closed",autoscroll:!0,allowDestruction:!1,destroyed:!1,displayed:!0,maxObjectLength:8192,icons:{menu:"bars",toggle:"terminal",save:"file-text",clear:"trash",close:"times",destroy:"unlink",example:"plus-circle",benchmark:"tachometer",settings:"cogs",expand:"caret-square-o-right",toggleObjs:"list-alt"},benchmark:{amount:1e4}},modals:{behaviour:{stack:!0,shift:!0}}},interactor:{enabled:!0,observe:!1,expandOnclick:!0,filters:{metadata:{},clientdata:{}}},events:{silent:!1},cookies:{enabled:!0,prefix:"__kbs_"},routes:{console:{save:"endpoint/SaveBuffer.php"}},tooltips:{save:"Save log buffer",clear:"Clear console",menu:"Kanban Menu",toggle:"Toggle the console",close:"Close",destroy:"Destroy console",benchmark:"Benchmark",settings:"Settings",toggleObjs:"Toggle object logs"}}),define("main/components/events",["config"],function(config){function Events(){this.topics={}}return Events.prototype.subscribe=function(event,handler){var len,i,attach=function(topic,handler){this.topics[topic]||(this.topics[topic]=[]),this.topics[topic].push(handler)}.bind(this);if(event instanceof Array)for(len=event.length,i=0;len>i;i+=1)attach(event[i],handler);else attach(event,handler)},Events.prototype.unsubscribe=function(event,handler){var list,xlen,ylen,object=!1,x=0,y=0;for("string"!=typeof handler&&(object=!0),!event instanceof Array&&(event=[event]),xlen=event.length;xlen>x;x+=1)for(list=this.topics[event[x]],ylen=list.length;ylen>y;y+=1)if(object){if(handler===list[y]||handler.toSource()===list[y].toSource())return void list.splice(list.indexOf(y),1)}else if(list[y].name===handler)return void list[y].splice(list.indexOf(y),1)},Events.prototype.publish=function(event,data){if(this.topics[event]){var i;for(i=0;i<this.topics[event].length;i+=1)this.topics[event][i](data,event)}else if(!config.events.silent)throw new Error("Event '"+event+"' does not exist!")},new Events}),define("main/components/status",{app:!1,interactor:{taskDetailsExpanded:!1},gui:!1,console:!1,modal:!1}),define("main/components/buffer",[],function(){function Buffer(predef){global.push(predef||""),this.index=global.length-1}var global=[];return Buffer.prototype.writeToBuffer=function(value){var buffer=this.index;return"string"==typeof global[buffer]?void(global[buffer]+=value):global[buffer]instanceof Array?void global[buffer].push(value):void 0},Buffer.prototype.removeFromBuffer=function(value){var position,buffer=this.index;return"string"==typeof global[buffer]?void(global[buffer]=global[buffer].replace(value,"")):global[buffer]instanceof Array?(position=global[buffer].indexOf(value),void global[buffer].splice(position,1)):void 0},Buffer.prototype.getBuffer=function(){return global[this.index]},Buffer.prototype.getGlobalBuffer=function(){return global},Buffer.prototype.clearBuffer=function(){var buffer=this.index;global[buffer]=null,global[buffer]=""},Buffer}),define("main/components/cache",["main/components/buffer"],function(Buffer){var cache={app:new Buffer,console:new Buffer,logCount:0};return cache}),define("main/components/cookies",["config"],function(config){function Cookies(){}return Cookies.prototype.get=function(name){var cookie,i,cname=config.cookies.prefix+name+"=",cookies=document.cookie.split(";");for(i=0;i<cookies.length;i+=1){for(cookie=cookies[i];" "===cookie.charAt(0);)cookie=cookie.substring(1);if(0===cookie.indexOf(cname))return cookie.substring(cname.length,cookie.length)}return""},Cookies.prototype.set=function(name,value,days){var expires,date;days?(date=new Date,date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()):expires="",document.cookie=config.cookies.prefix+name+"="+value+expires+"; path=/"},Cookies.prototype.del=function(name){this.set(name,"",-1)},Cookies.prototype.exists=function(name){var cookie=this.get(name);return""!==cookie&&null!==cookie&&void 0!==cookie},Cookies}),define("main/components/util",["config","main/components/events","main/components/status","main/components/cache","main/components/cookies","main/components/buffer"],function(config,events,status,cache,Cookies){function Util(){}var util=new Util;return Util.prototype.refresh=function(delay){"undefined"!=typeof delay?setTimeout(function(){location.reload()},delay):location.reload()},Util.prototype.zerofy=function(num,len){for(;num.toString().length<(len||2);)num="0"+num;return num},Util.prototype.spacify=function(str,len){for("string"!=typeof str&&(str=str.toString());str.length<len;)str=" "+str;return str},Util.prototype.prepend=function(char,str,len){for("string"!=typeof str&&(str=str.toString());str.length<len;)str=char+str;return str},Util.prototype.ftime=function(input,milliseconds){var time=input||new Date,hours=util.zerofy(time.getHours()),minutes=util.zerofy(time.getMinutes()),seconds=util.zerofy(time.getSeconds()),millis=util.zerofy(time.getMilliseconds(),3),string=hours+":"+minutes+":"+seconds;return milliseconds!==!1&&(string+="."+millis),string},Util.prototype.fdate=function(input){var time=input||new Date,year=util.zerofy(time.getFullYear(),4),month=util.zerofy(time.getMonth(),2),date=util.zerofy(time.getDate(),2);return year+"-"+month+"-"+date},Util.prototype.diff=function(num1,num2){return num1>num2?num1-num2:num2-num1},Util.prototype.escapeRegEx=function(str){var result;return result=String(str).replace(/([\-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},Util.prototype.execAll=function(array,data){var i=0,len=array.length;for(i;len>i;i+=1)util.isFunction(array[i])&&array[i](data)},Util.prototype.cookie=new Cookies,Util.prototype.isNode=function(obj){return"Node"===obj.constructor.name},Util.prototype.isDomElement=function(obj){return"object"==typeof window.HTMLElement?obj instanceof window.HTMLElement:obj&&"object"==typeof obj&&null!==obj&&1===obj.nodeType&&"string"==typeof obj.nodeName},Util.prototype.isTextNode=function(obj){return 3===obj.nodeType},Util.prototype.parseHTML=function(html){var element=document.createElement("div");return element.innerHTML=html,element},Util.prototype.isDate=function(obj){return"undefined"==typeof obj?!1:obj instanceof Date},Util.prototype.isArray=function(obj){return"undefined"==typeof obj?!1:obj instanceof Array||"Array"===obj.constructor.name},Util.prototype.isObject=function(obj){return"undefined"==typeof obj||util.isArray(obj)?!1:obj instanceof Object},Util.prototype.isFunction=function(obj){return"function"==typeof obj},Util.prototype.isString=function(obj){return"undefined"==typeof obj?!1:"string"==typeof obj},Util.prototype.isNumber=function(obj){return"undefined"==typeof obj?!1:"number"==typeof obj},Util.prototype.isBoolean=function(obj){return"undefined"==typeof obj?!1:"boolean"==typeof obj},Util.prototype.isEven=function(num){return num%2?!0:!1},Util.prototype.isOdd=function(num){return num%2?!1:!0},Util.prototype.isDefined=function(obj){return"undefined"!=typeof obj},Util.prototype.matrix=function(matrix){var result,len=6,i=0,err=function(msg){util.log("warn",msg+" arguments supplied to kbs.util.matrix, unexpected results may occur")};if(util.isString(matrix))return-1!==matrix.indexOf("matrix")?(result=matrix.match(/\(([^)]+)\)/),result=result[0].replace("(","[").replace(")","]"),result=util.unserialise(result)):result=util.unserialise(matrix),result;if(util.isArray(matrix)){for(result="",matrix.length<6&&err("Insufficient"),matrix.length>6&&err("Redundant"),matrix=matrix.slice(0,6),i=0,len=6;len>i;i+=1)util.isDefined(matrix[i])||(matrix[i]=0);return result="matrix("+util.serialise(matrix).replace("[","").replace("]","")+")"}},Util.prototype.capitalise=function(string){var ch,words=string.split(" "),len=words.length,i=0;for(i;len>i;i+=1)ch=words[i].charAt(0).toUpperCase(),words[i]=ch+words[i].slice(1);return words.join(" ")},Util.prototype.contains=function(host,target,strict){var regex,chk,temp,i=0;if("undefined"==typeof host)return util.log("error","Could not determine a contained value, haystack object is undefined!"),!1;if("undefined"==typeof target)return!1;if(chk=function(host,target){return strict?(target=util.escapeRegEx(target),regex=new RegExp("(\\W|^)"+target+"(\\W|$)"),regex.test(host)):-1!==host.indexOf(target)},strict=strict||!1,util.isArray(host)){for(i=0;i<host.length;i+=1)if(temp=util.contains(host[i],target,strict),temp!==!1)return temp}else if(util.isArray(target))for(i=0;i<target.length;i+=1)if(temp=util.contains(host,target[i],strict),temp!==!1)return temp;return chk(host,target)},Util.prototype.swap=function(array,i,j){var tmp=array[i];array[i]=array[j],array[j]=tmp},Util.prototype.clone=function(obj){var copy,attr,len,i;if(util.isDate(obj))return copy=new Date,copy.setTime(obj.getTime()),copy;if(util.isArray(obj)){for(copy=[],len=obj.length,i=0;len>i;i+=1)copy[i]=util.clone(obj[i]);return copy}if(util.isObject(obj)){copy={};for(attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=util.clone(obj[attr]));return copy}return util.isString(obj)||util.isNumber(obj)||util.isBoolean(obj)?copy=obj:void util.log("error","Couldn't clone object of unsupported type: "+typeof obj)},Util.prototype.merge=function(one,two,overwrite){var duplicate,exists,len,i;if(util.isObject(one))for(i in two)two.hasOwnProperty(i)&&(exists="undefined"!=typeof one[i],(!exists||exists&&overwrite)&&(util.isObject(two[i])?util.merge(one[i],two[i],overwrite):one[i]=two[i]));if(util.isArray(one))for(duplicate=overwrite,len=two.length,i=0;len>i;i+=1)(!util.contains(one,two[i])||duplicate)&&one.push(two[i]);return one},Util.prototype.serialise=function(object,json){var index,result,length,props,value,separate=!1;if(json="undefined"!=typeof json?json:!1,result=object,util.isObject(object))if(json)result=JSON.stringify(object);else{result="{",props=util.listProperties(object),separate=!0;for(index in object)object.hasOwnProperty(index)&&(result+='"'+index+'":'+util.serialise(object[index],json),props.indexOf(index)===props.length-1&&(separate=!1),separate&&(result+=", "));result+="}"}if(util.isArray(object)){for(index=0,length=object.length,result="[",index;length>index;index+=1)separate=index>0&&index!==length,separate&&(result+=", "),value=object[index],result+=util.isString(value)?'"'+value+'"':util.isNumber(value)?value:util.serialise(value,json);result+="]"}return util.isString(object)?'"'+result+'"':result},Util.prototype.unserialise=function(string,json){function parseArray(str){var strch,eov,len,ch,pch,result=[],value="",nstruct=new RegExp(/(\[)|(\{)/g),estruct=new RegExp(/(\])|(\})/g),instr=!1,depth=0,i=0;str=str.replace(/\s,*/g,""),str=str.replace(/,\s*/g,","),str=str.substring(1,str.length-1),len=str.length;do pch=str.charAt(i-1),ch=str.charAt(i),("'"===ch||'"'===ch)&&"\\"!==pch&&ch===strch&&(instr&&ch===strch?(instr=!1,strch=""):instr||(instr=!0,strch=ch)),nstruct.test(ch)&&!instr&&(depth+=1),estruct.test(ch)&&!instr&&(depth-=1),eov=(","===ch||estruct.test(ch))&&!depth&&!instr,eov||i===len?(result.push(util.unserialise(value,json)),value=""):value+=ch,i+=1;while(len>=i);return result}function parseObject(str){var result={};return str=str.replace(/(:\s)/g,":"),str=str.replace(/(\s\{)/g,"{"),str=str.replace(/(\{\s)/g,"{"),str=str.replace(/(\s\})/g,"}"),str=str.replace(/(\}\s)/g,"}"),result}function parseString(str){var quote=/(')|(")/g;if(str.charAt(0).match(quote)&&str.charAt(str.length-1).match(quote))str=str.substring(1,str.length-1);else{if(isNaN(parseFloat(str,10)))return str;str=parseFloat(str,10)}return str}var result;return json="undefined"!=typeof json?json:!0,result=string,util.isNumber(string)||util.isObject(string)||util.isArray(string)?string:"["===string.charAt(0)?parseArray(string):"{"===string.charAt(0)?json?JSON.parse(string):parseObject(string):util.isString(string)?parseString(string):result},Util.prototype.listProperties=function(obj){var index,list=[];if(util.isObject(obj)){for(index in obj)obj.hasOwnProperty(index)&&list.push(index);return list}},Util.prototype.sizeof=function(object){var len,i,bytes=0;if(null!==object&&void 0!==object)switch(typeof object){case"string":bytes+=2*object.length;break;case"number":bytes+=8;break;case"boolean":bytes+=4;break;case"object":if(util.isObject(object))for(i in object)object.hasOwnProperty(i)&&(bytes+=util.sizeof(object[i]));if(util.isArray(object))for(len=object.length,i=0;len>i;i+=1)bytes+=util.sizeof(object[i])}return bytes},Util.prototype.bytesFormat=function(x){return 1014>x?x+"bytes":1048576>x?(x/1024).toFixed(3)+"KB":1073741824>x?(x/1048576).toFixed(3)+"MB":(x/1073741824).toFixed(3)+"GB"},Util.prototype.log=function(context,type,msg,opt){function ctxArgsAdjust(){opt=msg,msg=type,type=context}if(config.logs.enabled){cache.logCount+=1;var param,i=0,args=[],filter=config.logs.filter,output=[],str="",object=!1,subcontext=!1,guistr="",objstr="",bffstr="",ctxFlag=config.logs.contextFlag,ctxDelFlag=config.logs.contextClearFlag;for(param in arguments)arguments.hasOwnProperty(param)&&args.push(arguments[param]);if(config.logs.contexts?"string"==typeof context?-1!==context.indexOf(ctxFlag)?util.log.currentContext!==!1?(subcontext=context.replace(ctxFlag,""),context=util.log.currentContext,args.shift()):(context=context.replace(ctxFlag,""),args.shift()):-1!==context.indexOf(ctxDelFlag)?args.shift():(ctxArgsAdjust(),context=util.log.currentContext):(ctxArgsAdjust(),context=util.log.currentContext):(-1!==context.indexOf(ctxFlag)?args.shift():ctxArgsAdjust(),context=!1,subcontext=!1),args.length>2?"object"==typeof msg&&(object=msg,msg=opt):args.length>1?"object"==typeof type?(object=type,type="log"):"object"==typeof msg&&(object=msg,msg=""):(msg=type,type="log","object"==typeof msg&&(object=msg,msg="")),!filter||util.contains(filter,type,!0)===!1)for(str+=util.ftime(),str+=" ["+(subcontext||context||config.appName)+"]",str+=" ["+type+"]:> ",str+=msg,output.push(str),object&&(objstr="Object "+JSON.stringify(object,null,4)),bffstr=str.replace(/\s/g," "),bffstr=encodeURIComponent(bffstr),bffstr+=config.logs.obj2buffer?""!==objstr?"\n"+objstr:"":""!==objstr?"\n[object omitted]":"",bffstr+="\n",cache.console.writeToBuffer(bffstr),config.logs.gui&&status.console&&(guistr=str.replace(/\s/g," "),events.publish("gui/log",{msg:guistr,type:type,obj:objstr,context:context,subcontext:subcontext})),window.console[type]||(type="log"),object&&output.push(object);i<output.length;)window.console[type](output[i]),i+=1}},Util.prototype.log.currentContext=util.log.currentContext||!1,Util.prototype.log.beginContext=function(context){return config.logs.contexts?-1!==context.indexOf(config.logs.contextFlag)?void util.log("error","You shouldn't pass the context flag when using beginContext()"):void(util.log.currentContext=context):void 0},Util.prototype.log.endContext=function(){util.log.currentContext=!1},Util.prototype.log.clearContext=function(context){events.publish("gui/contexts/clear",context)},Util.prototype.debug=function(){util.log("debug")},Util.prototype.warn=function(){util.log("warn")},Util.prototype.error=function(){util.log("error")},util.log("+ util.js loaded"),util}),define("main/components/exception",["main/components/util"],function(util){function Exception(err,msg){this.fileName=err.fileName,this.lineNumber=err.lineNumber,this.message=err.message,util.log("error",msg+" | Exception thrown in "+err.fileName+" at line "+err.lineNumber+". Error: "+err.message)}return Exception}),define("main/components/repository",[],function(){function Repository(){}var box={};return Repository.prototype.add=function(key,object){if(box[key])throw new Error("Couldn't add '"+key+"' to the repository,  key already exists. Delete the key first.");box[key]=object},Repository.prototype.get=function(key){return box[key]},Repository.prototype.del=function(key){delete box[key]},Repository.prototype.all=function(){return box},Repository}),define("main/components/counter",[],function(){function Counter(target,callback){var value=0,executed=!1;this.target=target,this.exec=callback,Object.defineProperty(this,"count",{get:function(){return value},set:function(newvalue){value=newvalue,value>=target&&!executed&&(executed=!0,this.exec())}})}return Counter}),define("main/components/http",["config","main/components/util","main/components/counter"],function(config,util){function Http(params){this.url=params.url,this.method=params.method||"GET",this.async=params.async||!0,this.data=params.data,this.callbacks={},this.callbacks.success=params.success||function(){},this.callbacks.fail=params.fail||function(){},self=this,params.send&&this.send(this.data)}var self,token=config.httpToken;return Http.prototype.encodeData=function(data){var i,encodedString="";for(i in data)data.hasOwnProperty(i)&&(encodedString+=i+"="+data[i]+"&");return token&&(encodedString+="kbstoken="+token),encodedString},Http.prototype.send=function(){var xml=new XMLHttpRequest;xml.open(this.method,this.url,this.async),xml.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xml.onreadystatechange=function(){4===this.readyState&&(200===this.status&&this.status<400?(util.log("debug","HTTP 200: "+self.url),self.callbacks.success(this.responseText)):(util.log("debug","HTTP "+this.status+": "+self.url),self.callbacks.fail(this.responseText)))},xml.send(self.encodeData(self.data)),xml=null},Http}),define("main/components/viewloader",["require"],function(require){function ViewLoader(){}return ViewLoader.prototype.load=function(view,callback){require(["main/views/"+view],function(mod){callback(mod)})},ViewLoader}),define("main/ui/node",["config","main/components/util"],function(config,util){function Node(type,classes,id){if(util.isString(type)&&("#"===type.charAt(0)||"."===type.charAt(0)))return new Node(document.querySelector(type),classes,id);var assoc=(ALL_NODES.length,this.findAssociatedNode(type));return assoc?assoc:(ALL_NODES.push(this),this.children=[],this.textNodes=[],void(util.isDomElement(type)?this.element=type:(this.settings={type:type,classes:classes,id:id},this.element=document.createElement(type),this.element.className=classes||"",id&&(this.element.id=id))))}var ALL_NODES=[];return Node.prototype.show=function(){return this.element.style.display="block",this},Node.prototype.hide=function(){return this.element.style.display="none",this},Node.prototype.toggle=function(){var method="none"===this.element.style.display?"block":"none";return this.element.style.display=method,this},Node.prototype.fadeIn=function(args){return"undefined"==typeof window.jQuery?(this.show(),this):(window.jQuery(this.element).fadeIn(args),this)},Node.prototype.fadeOut=function(args){return"undefined"==typeof window.jQuery?(this.hide(),this):(window.jQuery(this.element).fadeOut(args),this)},Node.prototype.getId=function(){return this.element.id},Node.prototype.getClasses=function(){return this.element.className},Node.prototype.hasClass=function(name){var i,len,found=!1;if(util.isArray(name))for(len=name.length,i=0;len>i;i+=1)-1!==this.element.className.indexOf(name[i])&&(found=!0);else-1!==this.element.className.indexOf(name)&&(found=!0);return found},Node.prototype.addClass=function(classes){-1===this.element.className.indexOf(classes)&&(""===this.element.className?this.element.className=classes:this.element.className+=" "+classes)},Node.prototype.removeClass=function(classes){var newclass,i,curr=this.element.className,remove=function(name){newclass=-1!==curr.indexOf(" "+name)?curr.replace(" "+name,""):-1!==curr.indexOf(name+" ")?curr.replace(name+" ",""):curr.replace(name,"")};if(util.isArray(classes))for(newclass=curr,i=0;i<classes.length;i+=1)this.removeClass(classes[i]);else remove(classes);this.element.className=newclass},Node.prototype.setClass=function(classes){this.element.className=classes},Node.prototype.toggleClass=function(name){this.hasClass(name)?this.removeClass(name):this.addClass(name)},Node.prototype.css=function(rule,property){var i,rules=rule.split("-");if(rules.length>1)for(i=1;i<rules.length;i+=1)rules[i]=util.capitalise(rules[i]);return rule=rules.join(""),"undefined"==typeof property||""===property?window.getComputedStyle(this.element,null).getPropertyValue(rule):(this.element.style[rule]=property,this)},Node.prototype.getComputedStyle=function(rule){return window.getComputedStyle(this.element,null).getPropertyValue(rule)},Node.prototype.parent=function(){return this.element?this.element.parentNode:null},Node.prototype.addChild=function(child){return child.constructor===Node||child instanceof Node?(this.element.appendChild(child.element),this.children.push(child),child):util.isDomElement(child)?(child=new Node(child),this.addChild(child)):util.isTextNode(child)?(this.textNodes.push(child),this.element.appendChild(child),child):void util.log("error",this,"Attempt to add a child element to Node failed, child is not of type Node or HTMLElement.")},Node.prototype.createChild=function(type,classes,id){var child=new Node(type,classes,id);return this.addChild(child),child},Node.prototype.detach=function(){return this.element.parentNode.removeChild(this.element)},Node.prototype.attach=function(){this.element.parentNode.appendChild(this.element)},Node.prototype.move=function(destination){var el=this.detach();util.isNode(destination)?destination.addChild(el):util.isDomElement(destination)&&destination.appendChild(el)},Node.prototype.translate=function(x,y){var matrix,currMatrix=this.css("transform");"none"===currMatrix?matrix=[0,0,0,0,x,y]:(matrix=util.matrix(currMatrix),matrix[4]=x,matrix[5]=y),matrix=util.matrix(matrix),this.css("transform",matrix)},Node.prototype.scale=function(val){var matrix,currMatrix=this.css("transform");"none"===currMatrix?matrix=[val,0,0,val,0,0]:(matrix[0]=val,matrix[3]=val),matrix=util.matrix(matrix),this.css("transform",matrix)},Node.prototype.getBounds=function(pos){var bounds=this.element.getBoundingClientRect();return"center"===pos?util.diff(bounds.left,bounds.right)/2:bounds[pos]},Node.prototype.destroy=function(){var xlen=this.children.length,ylen=ALL_NODES.length,x=0,y=0;if(xlen)for(x;xlen>x;x+=1)this.children[x]&&(this.children[x].destroy(),this.children[x]=null);if(ylen)for(y;ylen>y;y+=1)ALL_NODES[y]&&ALL_NODES[y].element===this.element&&ALL_NODES.splice(y,1);return this.parent()?void this.parent().removeChild(this.element):void(this.element=null)},Node.prototype.find=function(selector){var nodeList=this.element.querySelectorAll(":scope "+selector),len=nodeList.length,results=[],i=0;for(i;len>i;i+=1)results.push(new Node(nodeList[i]));return results},Node.prototype.clear=function(){var i=0,len=this.children.length;for(i;len>i;i+=1)this.children[i].destroy();this.element.innerHTML=""},Node.prototype.clone=function(){var clone=new Node(this.settings.type,this.getClasses(),this.getId());return clone.element=null,clone.element=this.element.cloneNode(),clone},Node.prototype.focus=function(){return this.element.focus(),this},Node.prototype.attr=function(name,value){return"undefined"==typeof value?this.element.getAttribute(name):(this.element.setAttribute(name,value),this)},Node.prototype.text=function(text,clear){return"undefined"==typeof text?this.element.textContent||this.element.value:(clear&&(this.element.textContent="",this.element.value=""),text=document.createTextNode(text),this.addChild(text),this)},Node.prototype.val=function(value){return"undefined"==typeof value?"SELECT"===this.element.nodeName?this.element.selectedOptions[0].value:this.element.value:(this.element.value=value,this)},Node.prototype.on=function(event,listener){return this.element.addEventListener(event,listener),this},Node.prototype.off=function(event,listener){return this.element.removeEventListener(event,listener),this},Node.prototype.writeTo=function(element){"undefined"!=typeof element&&element.appendChild(this.element)},Node.prototype.hasChildren=function(){return this.children.length},Node.prototype.is=function(element){return this.element===element},Node.prototype.findAssociatedNode=function(element){var len=ALL_NODES.length,i=0;for(i;len>i;i+=1)if(ALL_NODES[i].element===element)return ALL_NODES[i];return!1},Node.prototype.count=function(){return ALL_NODES.length},Node.prototype.ALL_NODES=ALL_NODES,Node}),define("main/ui/modal",["config","main/components/util","main/components/events","main/components/status","main/components/repository","main/components/http","main/components/viewloader","main/ui/node"],function(config,util,events,status,repo,Http,ViewLoader,Node){function evtlog(modal,event){util.log("context:gui","debug","Modal '"+modal.viewName+"' event '"+event+"' fired")}function ModalController(){this.list={},this.active=null,this.stacked=[],this.opened=[],events.subscribe(["gui/modal/open","gui/modal/close","gui/modal/destruct"],this.processStack.bind(this)),this.events=["init","load","reload","open","close","destruct","confirm","proceed","cancel"];var len=this.events.length,i=0;for(i;len>i;i+=1)events.subscribe("gui/modal/"+this.events[i],evtlog)}function Modal(view,params){if(params=params||{init:!0},"undefined"==typeof params.init&&(params.init=!0),ctrl.exists(view)){var modal=ctrl.getModalByName(view);return ctrl.isStacked(modal)?(ctrl.swapStack(modal),modal):(params.init&&modal.init(),modal)}this.viewName=view,this.viewParams=params.viewParams||{},this.params=params,this.classes=params.classes||"",this.inited=!1,this.loaded=!1,this.createEvents(),this.node=new Node("div","kbs-modal kbs-"+view),this.node.addClass(this.classes),this.node.hide(),this.shieldNode=this.node.createChild("div","kbs-modal-shield"),this.view=null,this.init=this.rInit.bind(this),this.open=this.rOpen.bind(this),this.close=this.rClose.bind(this),this.clear=this.rClear.bind(this),this.destroy=this.rDestroy.bind(this),this.applyHandlers(params),this.load(params.init?this.init:function(){}),ctrl.addModal(this)}var gui,ctrl,vloader=new ViewLoader;return ModalController.prototype.processStack=function(data,event){var active=this.active,opened=this.opened,stacked=this.stacked,modal=data;util.log("context:gui","debug","processing modal stack"),"gui/modal/open"===event&&(active&&!active.dueRemoval&&this.addToStack(active),this.addToOpened(modal)),"gui/modal/close"===event&&(this.isStacked(modal)&&this.removeFromStack(modal),stacked.length?(modal=stacked[stacked.length-1],modal.open(),this.removeFromStack(modal)):opened.length||(this.active=null,gui.preserveOverlay=!1,status.interactor.taskDetailsExpanded||gui.hideOverlay()),this.removeFromOpened(modal)),(stacked.length||opened.length)&&(gui.preserveOverlay=!0)},ModalController.prototype.addToStack=function(modal,index){util.log("context:gui","debug","Adding modal '"+modal.viewName+"' to stack"),modal.node.addClass("kbs-stacked"),index?this.stacked[index]=modal:this.stacked.push(modal),this.shiftStack()},ModalController.prototype.removeFromStack=function(modal){var array=this.stacked,index=array.indexOf(modal);this.stacked.splice(index,1),modal.node.removeClass("kbs-stacked"),this.shiftStack(),util.log("context:gui","debug","Removed modal '"+modal.viewName+"' from stack")},ModalController.prototype.shiftStack=function(){var modal,offset,stack=this.stacked,len=stack.length,i=0;if(this.getBehaviour("shift"))for(util.log("context:gui","debug","shifting stack"),i;len>i;i+=1)modal=stack[i],modal.node.removeClass("kbs-shift-left"),modal.node.removeClass("kbs-shift-right"),0!==i&&(util.isEven(i)&&(offset="kbs-shift-left"),util.isOdd(i)&&(offset="kbs-shift-right"),modal.node.addClass(offset),util.log("context:gui","debug","set offset of "+offset+" to '"+modal.viewName+"'"))},ModalController.prototype.swapStack=function(index){var modal,active=this.active,stacked=(this.opened,this.stacked);return util.isNumber(index)?void(modal=stacked[index]):(util.isString(index)&&(modal=this.getModalByName(index)),util.isObject(index)&&(modal=index),this.removeFromStack(modal),this.shiftStack(),this.addToStack(active),void(this.active=modal))},ModalController.prototype.getStackIndex=function(modal){var stacked=this.stacked,len=stacked.length,i=0;for(i;len>i;i+=1)if(stacked[i]===modal)return i},ModalController.prototype.addModal=function(modal){this.list[modal.viewName]=modal},ModalController.prototype.removeModal=function(modal){delete this.list[modal.viewName||modal]},ModalController.prototype.addToQueue=function(modal){this.queued.push(modal)},ModalController.prototype.removeFromQueue=function(modal){var array=this.queued,index=array.indexOf(modal.viewName||modal);this.queued.splice(index,1)},ModalController.prototype.addToOpened=function(modal){this.opened.push(modal)},ModalController.prototype.removeFromOpened=function(modal){var array=this.opened,index=array.indexOf(modal.viewName||modal);this.opened.splice(index,1)},ModalController.prototype.isActive=function(modal){return this.active===modal},ModalController.prototype.isOpen=function(modal){return-1!==this.opened.indexOf(modal)},ModalController.prototype.isQueued=function(modal){return-1!==this.queued.indexOf(modal)},ModalController.prototype.isStacked=function(modal){return-1!==this.stacked.indexOf(modal)},ModalController.prototype.getModalByName=function(name){return this.list[name]},ModalController.prototype.exists=function(name){var exists=!1,modal=this.getModalByName(name);return"undefined"!=typeof modal&&null!==modal&&(exists=!0),exists},ModalController.prototype.getBehaviour=function(name){return config.gui.modals.behaviour[name]},ctrl=new ModalController,Modal.prototype.createEvents=function(){var y,x=0,len=ctrl.events.length,evtcreate=function(){};for(this.eventName={},x;len>x;x+=1)this.eventName[ctrl.events[x]]="gui/modal/"+this.viewName+x;for(y in this.eventName)this.eventName.hasOwnProperty(y)&&events.subscribe(this.eventName[y],evtcreate)},Modal.prototype.load=function(callback){var view,self=this,params=this.viewParams;this.loaded||(this.loaded=!0,vloader.load("modals/"+this.viewName,function(mod){view=mod.draw([gui,self,params]),self.view=view,self.viewModule=mod,self.title=view.title,self.trigger("load",self),util.isFunction(callback)&&callback()}))},Modal.prototype.reload=function(page){var self=this,view=this.viewModule,render=view.draw([gui,self,self.viewParams],page),content=this.node.find(".kbs-modal-content")[0];content.clear(),content.addChild(render),this.trigger("reload",this)},Modal.prototype.on=function(event,handler){try{events.subscribe(this.eventName[event],handler)}catch(e){util.log("error","Modal handler attachment failed with: "+e.message)}},Modal.prototype.off=function(event,handler){try{events.unsubscribe(this.eventName[event],handler)}catch(e){util.log("error","Modal handler removal failed with: "+e.message)}},Modal.prototype.trigger=function(event,data){events.publish("gui/modal/"+event,data),events.publish(this.eventName[event],data)},Modal.prototype.hide=function(){this.node.hide()},Modal.prototype.show=function(){this.node.show()},Modal.prototype.setTitle=function(text){this.node.find(".kbs-modal-title")[0].text(text,!0)},Modal.prototype.applyHandlers=function(){var self=this,err=function(event){util.log("warn","Modal '"+self.viewName+"' event '"+event+"' ran but didn't have a handler!")},params=this.params;this.shieldNode.on("click",function(){ctrl.swapStack(self.viewName)}),this.on("confirm",params.confirm||function(){err("confirm")}),this.on("cancel",params.cancel||function(){err("cancel")}),this.on("proceed",params.proceed||function(){err("proceed")})},Modal.prototype.rInit=function(){if(this.inited)return this.open(),this;var modal=this.node,self=this,title=modal.createChild("h2","kbs-modal-title"),close=modal.createChild("i","fa fa-times kbs-modal-closed"),content=modal.createChild("p","kbs-modal-content");title.text(this.title),close.on("click",function(){self.dueRemoval=!0,self.close()}),content.addChild(this.view),gui.addChild(modal),this.inited=!0,this.trigger("init",this),this.open()},Modal.prototype.rOpen=function(){return ctrl.isActive(this)?void 0:this.inited?(this.dueRemoval=!1,gui.showOverlay(),this.node.fadeIn(),this.trigger("open",this),ctrl.active=this,this):this.init()
},Modal.prototype.rClose=function(){this.node.hide(),ctrl.removeFromOpened(this),this.trigger("close",this)},Modal.prototype.rClear=function(){var content=this.node.find(".kbs-modal-content")[0];content.clear()},Modal.prototype.rDestroy=function(){ctrl.isOpen(this)&&this.rClose(),this.inited=!1,this.loaded=!1,ctrl.removeModal(this),this.trigger("destruct",this),this.node.destroy()},Modal.prototype.setInstance=function(instance){gui=instance},Modal.prototype.getController=function(){return ctrl},Modal}),define("main/components/configurator",["config","main/components/util","main/ui/modal"],function(config,util,Modal){function Configurator(){return self?self:(self=this,this.def=util.clone(config),this.modal=null,this.launchModal=this.rLaunchModal.bind(this),void(this.reloadModal=this.rReloadModal.bind(this)))}var self,modded={};return Configurator.prototype.getUserData=function(){var cookie=util.cookie.get("settings"),data=util.unserialise(cookie);return data||{}},Configurator.prototype.getUserCookie=function(){return util.cookie.get("settings")},Configurator.prototype.getFormattedUserCookie=function(){return JSON.stringify(modded,null,4)},Configurator.prototype.loadExisting=function(){var data=this.getUserData();return data?(util.log("loading existing user config"),modded=data,void util.merge(config,data,!0)):void util.log("error","no user data found!")},Configurator.prototype.modifiedProperties=function(){var prop,list=[];for(prop in modded)modded.hasOwnProperty(prop)&&list.push(prop);return list},Configurator.prototype.rLaunchModal=function(){this.modal?this.modal.init():this.modal=new Modal("user-config",{init:!0})},Configurator.prototype.rReloadModal=function(){this.modal&&this.modal.reload()},Configurator.prototype.get=function(selector){var i=0,segments=selector.split("/"),value=config,len=segments.length;for(i;len>i;i+=1)value=value[segments[i]];return value},Configurator.prototype.set=function(selector,value,reload){var parent,parentName,segments=selector.split("/"),len=segments.length,got=config,i=0,tree=modded;if(reload=reload||!1,1===len)return config[selector]=value,modded[selector]=value,util.cookie.set("settings",util.serialise(modded)),reload&&this.modal.reload(!0),config[selector];for(i;len>i;i+=1)i===len-2&&(parent=got[segments[i]],parentName=segments[i]),got=got[segments[i]],i!==len-1?(tree[segments[i]]=tree[segments[i]]||{},tree=tree[segments[i]]):tree[segments[i]]=value;return parent[segments[len-1]]=value,util.cookie.set("settings",util.serialise(modded)),reload&&this.modal.reload(!0),parent[segments[len-1]]},Configurator.prototype.reset=function(){var i;for(i in config)config.hasOwnProperty(i)&&(self.def[i]||delete config[i],config[i]=self.def[i]);util.cookie.del("settings"),location.hash="settings",location.reload()},Configurator}),define("main/components/bugherd",["config","main/components/util","main/components/cache","main/components/status","main/components/repository","main/ui/node"],function(config,util,cache,status,Repository,Node){function TaskController(){this.api=bh.application.tasksCollection,this.baseApi=instance,this.setSeverityStyle=this.rSetSeverityStyle.bind(this),this.setAllSeverityStyles=this.rSetAllSeverityStyles.bind(this)}function BugHerd(){return instance?instance:(instance=this,interactor=interactor||repo.get("interactor"),gui=gui||repo.get("gui"),this.api=bh,this.tasks=new TaskController,void this.init())}{var interactor,instance,gui,repo=new Repository,bh=window.bugherd;window.jQuery}return TaskController.prototype.init=function(){var self=this;this.applyHandlers(),config.gui.severityStyles&&(setTimeout(function(){self.setAllSeverityStyles()},100),bh.application.on("change",function(){setTimeout(self.setAllSeverityStyles,100)}))},TaskController.prototype.findModelByLocalId=function(id){var tasks=this.baseApi.getTasks(),len=tasks.length,i=0;for(id=parseInt(id,10),i;len>i;i+=1)if(tasks[i].attributes.local_task_id===id)return tasks[i]},TaskController.prototype.findModelByGlobalId=function(id){var tasks=this.baseApi.tasks(),len=tasks.length,i=0;for(i;len>i;i+=1)if(tasks[i].id===id)return tasks[i]},TaskController.prototype.getBrowserInfo=function(task,key){return util.isObject(task)||util.isNumber(task)||util.log("error","Unable to get task from parameter of type "+typeof task),util.isNumber(task)&&(task=task>1e6?this.findModelByGlobalId(task):this.findModelByLocalId(task)),task.attributes.browser_info[key]||task.attributes.browser_info},TaskController.prototype.getMeta=function(task){return util.isNumber(task)&&(task=task>1e6?this.findModelByGlobalId(task):this.findModelByLocalId(task)),task.attributes.data.userMetaData},TaskController.prototype.findAllWithMeta=function(attr,value){return this.match(function(task){var meta=task.getData().userMetaData||{};return util.isDefined(meta[attr])&&(meta[attr]===value||util.contains(meta[attr],value))?!0:!1})},TaskController.prototype.findAllWithAttribute=function(attr,value){return this.match(function(task){var attrs=task.attributes;return attrs[attr]===value||util.contains(attrs[attr],value)?!0:!1})},TaskController.prototype.findAllWithClientData=function(attr,value){return this.match(function(task){var data=task.getBrowserData()||{};return util.isDefined(data[attr])&&(data[attr]===value||util.contains(data[attr],value))?!0:!1})},TaskController.prototype.findAllWithTag=function(tag){return this.match(function(task){var tags=task.attributes.tag_names;return util.contains(tags,tag)?!0:!1})},TaskController.prototype.match=function(matched){var task,tasks=this.api.models,len=tasks.length,results=[],i=0;for(i;len>i;i+=1)task=tasks[i],matched(task)&&results.push(task);return results},TaskController.prototype.applyHandlers=function(){var self=this,bh=this.baseApi,eventLog=function(task,type,msg){var message,user=task.attributes.requester_name,id=task.attributes.local_task_id,prevStatusId=task._previousAttributes.status_id,statusId=task.attributes.status_id,prevStatus=bh.getStatusFromId(prevStatusId),status=bh.getStatusFromId(statusId),severityId=task.attributes.priority_id,severity=bh.getPriorityFromId(severityId);message=msg.replace("${user}",user),message=message.replace("${id}",id),message=message.replace("${prevStatus}",prevStatus),message=message.replace("${status}",status),message=message.replace("${severity}",severity),util.log("context:bugherd",type,task,message),cache.RECENT_TASK=task};this.on("add",function(event){eventLog(event,"okay","Task '#${id}' created by '${user}'"),self.setAllSeverityStyles()}),this.on("remove",function(event){eventLog(event,"warn","Task '#${id}' was deleted"),status.interactor.taskDetailsExpanded&&parseInt(interactor.activeTask,10)===event.attributes.local_task_id&&interactor.closeTask(),self.setAllSeverityStyles()}),this.on("refresh",function(event){eventLog(event,"info","Task '#${id}' refreshed"),self.setAllSeverityStyles()}),this.on("change:status_id",function(event){eventLog(event,"info","Task '#${id}' moved from '${prevStatus}' to '${status}'"),self.setAllSeverityStyles()}),this.on("change:priority_id",function(event){eventLog(event,"info","Task '#${id}' set to '${severity}'"),self.setAllSeverityStyles()})},TaskController.prototype.on=function(event,handler){this.api.on(event,handler)},TaskController.prototype.rSetSeverityStyle=function(task){var severity;task=new Node(document.querySelector("#task_"+task)),severity=task.find(".task-severity"),severity.length&&(severity=severity[0].element.className.replace("task-severity","").replace(/\s/g,""),task.addClass(severity))},TaskController.prototype.rSetAllSeverityStyles=function(){var id,tasks=document.querySelectorAll(".task"),len=tasks.length,i=0;for(i;len>i;i+=1)id=tasks[i].id.replace("task_",""),id&&this.setSeverityStyle(id)},BugHerd.prototype.init=function(){this.tasks.init(),this.applyContext(),this.applyHandlers()},BugHerd.prototype.applyHandlers=function(){},BugHerd.prototype.applyContext=function(){util.log("context:bugherd","buffer","log-buffer: BUGHERD-API")},BugHerd.prototype.on=function(event,handler){bh.application.on(event,handler)},BugHerd.prototype.trigger=function(event){bh.application.trigger(event)},BugHerd.prototype.getStatusFromId=function(id){var map={"null":"feedback",0:"backlog",1:"todo",2:"doing",4:"done",5:"archive"};return map[id]},BugHerd.prototype.getPriorityFromId=function(id){var map={0:"not set",1:"critical",2:"important",3:"normal",4:"minor"};return map[id]},BugHerd.prototype.getTasks=function(){return bh.application.tasksCollection.models},BugHerd}),define("main/components/router",["config"],function(config){var routes={"console/save":config.routes.console.save},url=window.KBS_BASE_URL;return{getRoute:function(component,fn){return"undefined"==typeof fn?url+routes[component]:url+config.routes[component][fn]}}}),define("main/ui/console",["config","main/components/util","main/components/events","main/components/http","main/components/status","main/components/router","main/components/cache","main/components/configurator","main/ui/node","main/ui/modal"],function(config,util,events,Http,status,router,cache,Configurator,Node,Modal){function Console(instance){if(config.logs.gui){if(self=this,"undefined"==typeof instance)throw new Error("No GUI instance passed to Console");this.tools={},gui=instance,this.buildNodeTree(),this.setContexts(),this.logs=[],events.subscribe("gui/contexts/clear",function(context){self.clearContext(context)}),events.publish("kbs/status",{component:"console",status:!0})}}var self,gui,configurator=new Configurator;return Console.prototype.setContexts=function(){this.contexts||(this.contexts={def:self.wrapper.cons.out})},Console.prototype.getContext=function(context){return config.logs.contexts?this.contexts[context]:this.contexts.def},Console.prototype.createContext=function(context,element){if(config.logs.contexts){var contextNode;return this.contexts[context]&&util.log("error","Log context: '"+context+"' is already defined"),util.isNode(element)?contextNode=element.createChild("div","kbs-log-context",context):(contextNode=new Node("div","kbs-log-context","kbs-ctx-"+context),element.appendChild(contextNode.element)),this.contexts[context]=contextNode,contextNode}},Console.prototype.clearContext=function(context){"def"!==context&&(self.contexts[context]=null,delete self.contexts[context])},Console.prototype.write=function(args){var contextParent,objtxt,context=self.getContext("def"),log=new Node("div","kbs-log-node kbs-"+args.type),txt=document.createTextNode(args.msg),objwrap=new Node("pre","kbs-object"),objexp=new Node("i","fa fa-"+self.getIcon("expand")+" kbs-object-expand"),doCreateContext=!1;args.context&&(args.subcontext?self.getContext(args.subcontext)?context=self.getContext(args.subcontext):(context=self.getContext(args.context),doCreateContext=args.subcontext):self.getContext(args.context)?context=self.getContext(args.context):doCreateContext=args.context),log.addChild(txt),args.obj&&(args.obj.length>config.gui.console.maxObjectLength&&(args.obj=args.obj.slice(0,-util.diff(args.obj.length,config.gui.console.maxObjectLength-3)),args.obj+="..."),objtxt=document.createTextNode(args.obj),objexp.element.onclick=function(event){var btn=event.target,parent=btn.parentNode;util.contains(parent.className,"kbs-expand")?(parent.className=parent.className.replace(" kbs-expand",""),btn.className=btn.className.replace(" kbs-rotate","")):(parent.className+=" kbs-expand",btn.className+=" kbs-rotate")},objwrap.addChild(objexp),objwrap.addChild(objtxt),log.addChild(objwrap)),context.parentNode&&(contextParent=context.parentNode.className,args.type.match(/(test)|(buffer)/)&&util.contains(contextParent,"kbs-exec")&&log.addClass("kbs-log-closed")),context.addChild(log),self.logs.push(log),doCreateContext&&self.createContext(doCreateContext,log),self.scrollToElement(log.element)},Console.prototype.createTool=function(tool){var icon,toolbar=this.wrapper.constools;if("undefined"==typeof toolbar)throw new Error("Could not create new tool, no toolbar!");return icon=this.getIcon(tool),toolbar[tool]=toolbar.createChild("i","fa fa-"+icon+" kbs-tool kbs-"+tool),toolbar[tool].element.title=config.tooltips[tool]||"",this.tools[tool]=toolbar[tool],toolbar[tool]},Console.prototype.removeTool=function(tool){this.tools[tool].destroy()},Console.prototype.getIcon=function(tool){return config.gui.console.icons[tool]||"plus"},Console.prototype.open=function(){self.wrapper.removeClass("kbs-closed"),self.wrapper.addClass("kbs-open")},Console.prototype.close=function(){self.wrapper.removeClass("kbs-open"),self.wrapper.addClass("kbs-closed")},Console.prototype.scrollToElement=function(element){var cons=self.wrapper.cons.element;cons.scrollTop=element.offsetTop},Console.prototype.toggleObjectLogs=function(){var displayed,objs=document.querySelectorAll(".kbs-object"),len=objs.length,i=0;for(i;len>i;i+=1)displayed="none"!==objs[i].style.display,objs[i].style.display=displayed?"none":"block"},Console.prototype.clear=function(){var deltaTime,cons=self.wrapper.cons.element,out=self.wrapper.cons.out.element,start=(new Date).getTime(),logs=self.logs,len=logs.length,count=0,i=0;for(cons.removeChild(out),i;len>i;i+=1)logs[i].destroy(),count+=1;cons.appendChild(out),deltaTime=(new Date).getTime()-start,util.log("okay","cleared "+count+" logs in "+deltaTime+" ms"),cache.console.clearBuffer(),cache.logCount=0},Console.prototype.save=function(){var req,date=(util.ftime(),util.fdate()),buffer=cache.console.getBuffer();util.log.beginContext("log/save"),util.log("info","saving log buffer..."),req=new Http({url:router.getRoute("console/save"),method:"POST",send:!0,data:{type:"log",date:date,buffer:buffer},success:function(response){util.log("context:log/save","okay",response),util.log.endContext(),util.log.clearContext("log/save")}})},Console.prototype.destroy=function(){var modal=new Modal("console-destruct",{init:!0,confirm:function(){self.commitDestroy(modal,"hard")},cancel:function(){modal.close()}})},Console.prototype.commitDestroy=function(modal,method){if("hard"===method){var parent=self.wrapper.cons.parent(),child=self.wrapper.cons.element;cache.console.parent=parent,cache.console.child=child,parent.removeChild(child)}status.console=!1,cache.console.clearBuffer(),self.wrapper.addClass("kbs-disabled"),self.removeTool("destroy"),modal&&modal.close(),configurator.set("gui/console/destroyed",!0)},Console.prototype.restore=function(){this.wrapper.removeClass("kbs-disabled")},Console.prototype.buildNodeTree=function(){var wrapper,consclass,constools,constitle,titlenode,cons,consout,connection=-1!==window.KBS_BASE_URL.indexOf("localhost")?"local":"remote";return consclass="kbs-cons-box "+config.gui.console.state,this.wrapper=wrapper=gui.createChild("div",consclass),config.logs.enabled||wrapper.addClass("kbs-disabled"),constools=wrapper.constools=wrapper.createChild("div","kbs-cons-toolbar"),constitle=constools.constitle=constools.createChild("div","kbs-cons-title"),titlenode=document.createTextNode(config.appFullname+" v"+config.version+" - "+connection),constitle.addChild(titlenode),config.logs.enabled&&(this.createTool("menu").on("click",function(){var closed=wrapper.hasClass("kbs-closed"),full=wrapper.hasClass("kbs-full");closed||full||wrapper.addClass("kbs-full"),full&&wrapper.removeClass("kbs-full"),closed&&self.open()}),this.createTool("toggle").on("click",function(){var displayed=configurator.get("gui/console/displayed");wrapper.toggleClass("kbs-disabled"),configurator.set("gui/console/displayed",displayed?!1:!0)}),-1!==window.KBS_BASE_URL.indexOf("localhost")&&this.createTool("save").on("click",self.save),this.createTool("benchmark").on("click",self.benchmark),this.createTool("toggleObjs").on("click",self.toggleObjectLogs),config.gui.console.allowDestruction&&this.createTool("destroy").on("click",self.destroy),this.createTool("clear").on("click",self.clear)),this.createTool("settings").on("click",configurator.launchModal),config.logs.enabled&&this.createTool("close").on("click",self.close),wrapper.cons=cons=wrapper.createChild("div","kbs-cons"),config.logs.enabled||cons.hide(),consout=cons.out=cons.createChild("div","kbs-cons-out"),config.gui.console.destroyed&&this.commitDestroy(!1,"hard"),config.gui.console.displayed||this.wrapper.addClass("kbs-disabled"),wrapper},Console.prototype.benchmark=function(){var deltaTime,deltaSpeed,result,cons=self.wrapper.cons.element,out=self.wrapper.cons.out.element,amount=config.gui.console.benchmark.amount,start=(new Date).getTime(),i=0;for(util.log("context:benchmark","exec","executing benchmark..."),util.log.beginContext("benchmark"),cons.removeChild(out),util.log("context:benchmark/output","buffer","benchmark output...");amount>i;)util.log("context:benchmark/output","debug","log #"+(i+1)),i+=1;cons.appendChild(out),deltaTime=(new Date).getTime()-start,deltaSpeed=Math.floor(amount/deltaTime*1e3),result="Logged "+amount+" messages in "+deltaTime+"ms",util.log("context:benchmark","okay",result),util.log("okay",deltaSpeed+" logs per second."),util.log.endContext(),self.clearContext("benchmark"),self.clearContext("benchmark/output")},Console}),define("main/ui/gui",["config","main/components/util","main/components/events","main/components/status","main/components/counter","main/components/configurator","main/ui/node","main/ui/console","main/ui/modal"],function(config,util,events,status,Counter,Configurator,Node,Console,Modal){function GUI(){self=this,Modal.prototype.setInstance(this),this.applyContext(),this.setModalApi(),this.tree=this.buildNodeTree(),this.console=new Console(this),this.preserveOverlay=!1,this.init(),events.publish("kbs/status",{component:"gui",status:!0})}var self,configurator=new Configurator;return util.log("+ gui.js loaded"),GUI.prototype.init=function(){var loader=new Counter(config.offline?2:3,function(){events.publish("kbs/gui/loaded")}),mainlink=document.createElement("link"),themelink=document.createElement("link"),falink=document.createElement("link"),mainurl=window.KBS_BASE_URL+"css/main.css",themeurl=window.KBS_BASE_URL+"css/themes/"+(config.theme||"default")+".css",faurl="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css",publish=function(){document.body.appendChild(self.tree.main.element),util.log("context:gui/init","+ attached gui tree"),self.runEventListeners(),self.loadWallpaper(),events.publish("kbs/loaded")};config.gui.enabled&&(config.logs.gui&&events.subscribe("gui/log",this.console.write),events.subscribe("kbs/gui/loaded",publish)),mainlink.rel="stylesheet",themelink.rel="stylesheet",falink.rel="stylesheet",mainlink.href=mainurl,themelink.href=themeurl,falink.href=faurl,themelink.id="kbs-theme-link",util.log("context:gui/init","info","Initialising GUI..."),mainlink.onload=function(){util.log("context:gui/init","+ main.css loaded"),loader.count+=1},mainlink.onerror=function(){throw loader.count+=1,new Error("main.css failed to load!")},themelink.onload=function(){var themename=self.getThemeName();util.log("context:gui/init","+ theme '"+themename+"' loaded"),loader.count+=1},themelink.onerror=function(){loader.count+=1,util.log("error","theme '"+self.getThemeName()+"' failed to load!")},falink.onload=function(){util.log("context:gui/init","+ font-awesome.css loaded"),loader.count+=1},falink.onerror=function(){throw loader.count+=1,new Error("font-awesome.css failed to load!")},config.offline||document.head.appendChild(falink),document.head.appendChild(mainlink),document.head.appendChild(themelink)},GUI.prototype.applyContext=function(){events.subscribe("kbs/gui/loaded",function(){util.log("context:gui","buffer","log-buffer: GUI")})},GUI.prototype.getThemeName=function(url){var themelink=document.getElementById("kbs-theme-link"),name=url||themelink.href;return name=name.replace(window.KBS_BASE_URL+"css/themes/",""),name=name.replace(".css","")},GUI.prototype.resetTheme=function(){self.loadTheme(config.theme||"theme")},GUI.prototype.loadTheme=function(theme){var themelink=document.getElementById("kbs-theme-link"),node=new Node(themelink);theme=theme.replace(".css",""),node.attr("href",window.KBS_BASE_URL+"css/themes/"+theme+".css"),configurator.set("theme",theme)},GUI.prototype.unloadTheme=function(){var themelink=document.getElementById("kbs-theme-link"),node=new Node(themelink);node.attr("href","")},GUI.prototype.loadWallpaper=function(url){var el=new Node(document.getElementById("kanbanBoard"));url=url||config.gui.wallpaper,url="url('"+url+"')",el.css("background-image",url)},GUI.prototype.showOverlay=function(){status.gui.overlay||(self.tree.main.overlay.fadeIn(),status.gui.overlay=!0)},GUI.prototype.hideOverlay=function(){status.interactor.taskDetailsExpanded||self.preserveOverlay||(self.tree.main.overlay.fadeOut(),status.gui.overlay=!1)},GUI.prototype.buildNodeTree=function(){var main,tree={};return tree.main=main=new Node("div","kbs-gui"),main.overlay=main.createChild("div","kbs-overlay"),tree},GUI.prototype.runEventListeners=function(){util.log("context:gui/init","+ running event listeners");var current,togglables,out=this.console.wrapper.cons.out.element;togglables=config.logs.contexts?["kbs-exec","kbs-test","kbs-buffer"]:"",out.onclick=function(event){current=new Node(event.target),current.hasClass(togglables)&&(current.hasClass("kbs-log-closed")?current.removeClass("kbs-log-closed"):current.addClass("kbs-log-closed"))}},GUI.prototype.setModalApi=function(){this.modals=Modal.prototype.getController()},GUI.prototype.addChild=function(node){this.tree.main.addChild(node)},GUI.prototype.createChild=function(type,classes,id){var node=new Node(type,classes,id);return this.addChild(node),node},GUI.prototype.getCurrentInstance=function(){return self},GUI}),define("main/ui/interactor",["config","main/components/util","main/components/events","main/components/status","main/components/repository","main/components/configurator","main/ui/node","main/ui/modal"],function(config,util,events,status,Repository,Configurator,Node,Modal){function Interactor(){util.log("context:inter/init","info","Initialising Interactor..."),self=this,gui=repo.get("gui"),this.activeTask=null,this.init()}var $,self,gui,inited=!1,configurator=new Configurator,repo=new Repository;return Interactor.prototype.init=function(){if(!inited){if("undefined"==typeof window.jQuery)return void util.log("context:inter/init","error","Interactor could not initialise, jQuery not found!");$=window.jQuery,this.applyElements(),this.applyHandlers(),this.applyStyles(),this.applyContext(),this.applyHash(),inited=!0}},Interactor.prototype.isTask=function(element){return!element instanceof $&&(element=$(element)),element=element.closest("[id^=task_]"),element.length?element:!1},Interactor.prototype.openTask=function(localId){return util.log("context:interactor","debug","Opening task #"+localId+"..."),this.activeTask=localId,"undefined"==typeof localId?void this.expandTaskDetails():void this.findGlobalId(localId,function(task){setTimeout(function(){task.trigger("click")},500)})},Interactor.prototype.closeTask=function(){this.shrinkTaskDetails()},Interactor.prototype.expandTaskDetails=function(){$(".panelDetail").is(":visible")&&(status.interactor.taskDetailsExpanded||(this.activeTask=this.findLocalIdFromDetails(),util.log("context:interactor","debug","active task: #"+this.activeTask),$(".kbs-overlay").show(),$(".taskDetails").hide().addClass("kbs-details-expand"),setTimeout(function(){$(".taskDetails, .kbs-details-closed").fadeIn(),$(window).trigger("resize")},250),status.interactor.taskDetailsExpanded=!0))},Interactor.prototype.shrinkTaskDetails=function(){var task=$(".taskDetails"),btn=$(".kbs-details-closed");status.interactor.taskDetailsExpanded&&(this.activeTask=null,status.interactor.taskDetailsExpanded=!1,task.removeClass("kbs-details-expand"),btn.fadeOut(),gui.hideOverlay())},Interactor.prototype.searchForTask=function(localId,callback){{var facet,search=$(".VS-search-inner input"),event=$.Event("keydown");$("div.VS-icon:nth-child(4)")}util.log("context:interactor","Searching for task #"+localId),event.keyCode=40,search.focus().trigger(event).trigger(event).trigger(event),event.keyCode=13,search.focus().trigger(event),facet=$(".search_facet_input"),facet.val(localId).trigger("keydown"),setTimeout(function(){facet.trigger(event),setTimeout(function(){callback($(".task")),document.activeElement.blur(),setTimeout(function(){$("div.VS-icon:nth-child(4)").trigger("click"),document.activeElement.blur()},1e3)},500)})},Interactor.prototype.findGlobalId=function(localId,callback){var child,parent,globalId,errModal,errMsg,tasks=$(".task-id, .taskID"),check=function(){$(this)[0].textContent===localId.toString()&&(child=$(this))};return"undefined"==typeof localId&&(localId=$(".local_task_id")[0].textContent),tasks.each(check),"undefined"==typeof child?"undefined"==typeof callback?void util.log("context:interactor","error","Couldn't find global id for task #"+localId+". Provide a callback function to allow async task searches!"):void this.searchForTask(localId,function(task){self.findLocalIdFromTask(task)===localId?callback(task):(errMsg="Couldn't find task #"+localId,util.log("context:interactor","error",errMsg),errModal=new Modal("task-not-found",{init:!0,id:localId,confirm:function(){errModal.close(),errModal.getController().getModalByName("task-search").open()},cancel:function(){errModal.close()}}))}):(parent=child.closest(".task"),globalId=parent[0].id.replace("task_",""),callback&&callback(parent),globalId)},Interactor.prototype.findLocalId=function(globalId){return $("#task_"+globalId).find(".task-id, .taskID").text()},Interactor.prototype.findGlobalIdFromTask=function(task){var parent=task.closest(".task"),globalId=parent[0].id.replace("task_","");return globalId},Interactor.prototype.findLocalIdFromTask=function(task){var localId=(task.closest(".task"),task.find(".task-id, .taskID").text());return localId},Interactor.prototype.findLocalIdFromDetails=function(){var parent=$(".taskDetails"),localId=parent.find(".local_task_id");return localId.text()||localId.val()},Interactor.prototype.findTaskFromComponent=function(component){var task=component.closest("[id^=task_]");return task.length?this.findLocalIdFromTask(task):!1},Interactor.prototype.findModel=function(id){var bugherd=repo.get("bugherd");return bugherd.tasks.findModelByLocalId(id)},Interactor.prototype.navigateTo=function(board){var nav=$("#nav-"+board.toLowerCase());nav.length?nav.trigger("click"):util.log("context:interactor","error","Failed to navigate to: '"+board+"'")},Interactor.prototype.viewScreenshot=function(link){var modal,id,size=(repo.get("bugherd"),{});id=parseInt(self.findLocalIdFromDetails(),10),util.log("context:interactor","debug","Viewing screenshot for task #"+id),modal=new Modal("view-screenshot",{viewParams:{id:id,title:-1!==link[0].textContent.indexOf("screenshot")?"Screenshot":"Fix Result",url:link[0].href,width:size.x,height:size.y}})},Interactor.prototype.viewStats=function(id){id=id||null;var bugherd=repo.get("bugherd");taskStats=new Modal("task-stats",{viewParams:{object:bugherd.tasks.findModelByLocalId(104)}})},Interactor.prototype.onTasksWithTag=function(method,tag){var e,bugherd=repo.get("bugherd"),list=(bugherd.getTasks(),bugherd.tasks.findAllWithTag(tag)),len=list.length,i=0,x=0,disp="show"===method?"block":"none";if("list"===method){for(x;len>x;x+=1)list[x]=list[x].attributes.local_task_id;return new Modal("view-object",{viewParams:{message:list.length+" items:",object:list.sort()}})}for(i;len>i;i+=1)e=document.getElementById("task_"+list[i].id),e&&(e.style.display=disp)},Interactor.prototype.onTasksWithAttribute=function(method,key,value){var e,bugherd=repo.get("bugherd"),list=bugherd.tasks.findAllWithAttribute(key,value),len=list.length,i=0,x=0,disp="show"===method?"block":"none";if("list"===method){for(x;len>x;x+=1)list[x]=list[x].attributes.local_task_id;return new Modal("view-object",{viewParams:{message:list.length+" items:",object:list.sort()}})}for(i;len>i;i+=1)e=document.getElementById("task_"+list[i].id),e&&(e.style.display=disp)},Interactor.prototype.onTasksWithClientData=function(method,key,value){if(-1!==key.indexOf("[attr]"))return this.onTasksWithAttribute(method,key.replace("[attr]",""),value);var e,bugherd=repo.get("bugherd"),list=bugherd.tasks.findAllWithClientData(key,value),len=list.length,i=0,x=0,disp="show"===method?"block":"none";if("list"===method){for(x;len>x;x+=1)list[x]=list[x].attributes.local_task_id;return new Modal("view-object",{viewParams:{message:list.length+" items:",object:list.sort()}})}for(i;len>i;i+=1)e=document.getElementById("task_"+list[i].id),e&&(e.style.display=disp)},Interactor.prototype.onTasksWithMetaData=function(method,key,value){var e,bugherd=repo.get("bugherd"),list=bugherd.tasks.findAllWithMeta(key,value),len=list.length,i=0,x=0,disp="show"===method?"block":"none";if("list"===method){for(x;x<list.length;x+=1)list[x]=list[x].attributes.local_task_id;return new Modal("view-object",{viewParams:{message:list.length+" items:",object:list.sort()}})}for(i;len>i;i+=1)e=document.getElementById("task_"+list[i].id),e&&(e.style.display=disp)},Interactor.prototype.hideAllTasks=function(){var e,bugherd=repo.get("bugherd"),tasks=bugherd.getTasks(),len=tasks.length,i=0;for(i;len>i;i+=1)e=document.getElementById("task_"+tasks[i].id),e&&(e.style.display="none")},Interactor.prototype.showAllTasks=function(){var e,bugherd=repo.get("bugherd"),tasks=bugherd.getTasks(),len=tasks.length,i=0;for(i;len>i;i+=1)e=document.getElementById("task_"+tasks[i].id),e&&(e.style.display="block")},Interactor.prototype.resetAllFilters=function(){this.showAllTasks(),$("div.head-actions:nth-child(1) > ul:nth-child(1) > li:nth-child(1) > ul:nth-child(3) > li:nth-child(1) > a:nth-child(1)").trigger("click"),this.showAllTasks()},Interactor.prototype.getHash=function(){return window.location.hash},Interactor.prototype.parseHash=function(){var taskId,hash=this.getHash(),href=window.location.href;util.log("context:hash","parsing new hash: "+hash),"#open"===hash&&(taskId=-1!==href.indexOf("tasks/")?parseInt(href.split("tasks/")[1],10):parseInt(hash.replace("#open",""),10)),"#settings"===hash&&(configurator.launchModal(),location.hash=""),taskId&&this.openTask(taskId)},Interactor.prototype.applyElements=function(){var search,filter,detailClose,taskSearch,taskFilter,stats,nav;util.log("context:inter/init","+ appending elements to bugherd"),search=new Node("li"),search.createChild("a").text("Search Task").on("click",function(){taskSearch=new Modal("task-search",{proceed:function(localId){localId&&(taskSearch.close(),self.openTask(localId))}})}),filter=new Node("li"),filter.createChild("a").text("Filter").on("click",function(){taskFilter=new Modal("task-filter")}),stats=new Node("li"),stats.createChild("a").text("Stats").on("click",function(){self.viewStats()}),detailClose=new Node("div","kbs-details-closed"),detailClose.createChild("i","fa fa-times"),detailClose.on("click",function(){self.closeTask()}),nav=$(".nav.main-nav")[0],search.writeTo(nav),filter.writeTo(nav),stats.writeTo(nav),detailClose.writeTo($("body")[0])},Interactor.prototype.applyHandlers=function(){var move,frame,fc,appwrap=new Node(".app-wrap"),body=new Node(document.body),kanban=new Node("#kanbanBoard");util.log("context:inter/init","+ applying handlers to bugherd"),appwrap.on("click",function(event){var target=$(event.target),task=self.isTask(target);return task&&config.interactor.expandOnclick?void self.expandTaskDetails():void(target.hasClass("attachLink")&&target.text().match(/(fix-result)|(view_screenshot)|(\.png)|(\.jpg)/)&&(event.preventDefault(),self.viewScreenshot(target)))}),config.gui.wallpaper&&config.gui.parallax.enabled&&(move=!1,frame=setInterval(function(){move=move?!1:!0},32),body.on("mousemove",function(event){if(fc=config.gui.parallax.factor,move){var deltaX=-(event.pageX/fc),deltaY=-(event.pageY/fc);kanban.css("background-position",deltaX+"px "+deltaY+"px")}}))},Interactor.prototype.applyStyles=function(){util.log("context:inter/init","+ applying styles to bugherd"),$(".pane-center .pane-content").css("background-image",config.gui.wallpaper),$(".nav.user-menu").css("margin-right","10px"),-1!==gui.getThemeName().indexOf("DOS")&&($(".VS-icon-search").append('<i class="fa fa-search"></i>'),$(".VS-icon-search").css("top","8px"),$(".VS-icon-cancel").append('<i class="fa fa-times"></i>'),$(".VS-icon-cancel").css("top","8px"))
},Interactor.prototype.applyContext=function(){util.log("context:inter/init","+ applying interactor context"),util.log("context:interactor","buffer","log-buffer: INTERACTOR")},Interactor.prototype.applyHash=function(){util.log("context:inter/init","+ applying hash parser");window.location.href;util.log("context:hash","buffer","log-buffer: HASH"),this.getHash()&&setTimeout(function(){self.parseHash()},500),$(window).on("hashchange",function(){util.log("context:hash","hash changed: "+self.getHash()),self.parseHash()}),this.getHash()&&util.log("context:hash","found hash: "+this.getHash())},Interactor}),define("test/main.test",["require","main/components/util"],function(require,util){function TestController(){this.modules=["components/util","components/events"]}return TestController.prototype.exec=function(test){util.log("context:test/"+test,"exec",'executing test: "'+test+'"...'),require([window.KBS_BASE_URL+"src/test/"+test+".test.js"])},TestController.prototype.execAll=function(){var len=this.modules.length,i=0;for(i;len>i;i+=1)this.exec(this.modules[i])},new TestController}),define("main/init",["config","main/components/util","main/components/events","main/components/status","main/components/cache","main/components/exception","main/components/repository","main/components/http","main/components/configurator","main/components/bugherd","main/ui/node","main/ui/gui","main/ui/modal","main/ui/interactor","test/main.test"],function(config,util,events,status,cache,Exception,Repository,Http,Configurator,BugHerd,Node,GUI,Modal,Interactor,tests){var kanban,end,gui,interactor,ehandle,settings,bugherd,repo=new Repository;end=function(){window.KBS_DELTA_TIME=(new Date).getTime()-window.KBS_START_TIME+"ms",util.log("okay",kanban,"Kanban initialised in "+window.KBS_DELTA_TIME+". Approx. size: "+util.bytesFormat(util.sizeof(kanban))),"dev"===config.mode&&(window[config.appName]=kanban,window[config.appName+"_REPO"]=repo),"undefined"==typeof window.log&&(window.log=util.log),events.publish("kbs/status",{component:"app",status:!0}),config.test&&tests.execAll()},events.subscribe("kbs/loaded",end),events.subscribe("kbs/status",function(data){status[data.component]=data.status});try{settings=new Configurator,settings.loadExisting(),repo.add("settings",settings)}catch(configuratorException){ehandle=new Exception(configuratorException,"Configurator failed to initialise cleanly.")}if(config.enabled){try{config.gui.enabled&&(gui=new GUI,repo.add("gui",gui))}catch(guiException){ehandle=new Exception(guiException,"GUI failed to initialise cleanly.")}try{config.interactor.enabled&&(interactor=new Interactor,repo.add("interactor",interactor))}catch(interactorException){ehandle=new Exception(interactorException,"Interactor failed to initialise cleanly.")}try{bugherd=new BugHerd,repo.add("bugherd",bugherd)}catch(bugherdException){ehandle=new Exception(bugherdException,"BugHerd API failed to initialise cleanly.")}kanban={version:config.version,interactor:interactor,status:status,cache:cache,config:config,events:events,util:util,gui:gui,configurator:settings,Constructor:{Configurator:Configurator,Interactor:Interactor,GUI:GUI,BugHerd:BugHerd,Http:Http,Node:Node,Modal:Modal,Exception:Exception}}}}),function(window){var require=window.require,deposit=document.getElementById("kbs-deposit").classList;window.KBS_GLOBAL_SET="true"===deposit[0]?!0:!1,window.KBS_START_TIME=deposit[1],window.KBS_DELTA_TIME="",window.KBS_BASE_URL=deposit[2],require.config({paths:{main:window.KBS_BASE_URL+"src/main",test:window.KBS_BASE_URL+"src/test"}}),window.onload=function(){window.KBS_START_TIME=(new Date).getTime(),require(["main/init"])}}(window),define("kanban",function(){})}();